```{r, include = FALSE}
# Load init script
source("_script/init.R")
# knitr options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, fig.pos = "!tb")
options(kableExtra.html.bsTable = T)
# Function to round in solver
ceiling_digit = function(x, level=1) round(x+ 5*10^(-level-1), level)
flooring_digit = function(x, level=1) round(x - 5*10^(-level-1), level)
```

```{r hyper-param}
# Country set
country_set = c("France", "United States")
# Simulation periods
sim = seq(1970, 2080, 10)
# Estimation sample
est_sample = c(1970:2010)
# Graphic parameters
breaks_10_years = seq(1970, 2080, 10)
labs_20_years = as.vector(rbind(seq(1970, 2080, 20), rep("", length(breaks_10_years)/2)))
scale_graph = 1920/1080
```


```{r load_data}
# Penn World Table
pwt = file.path(loc_data, "pwt.csv") %>% read.csv %>%
  select("Country", "Year", "emp", "avh", "rgdpna", "rnna", "lab_sh1", "lab_sh2") %>% 
  subset(Country %in% country_set & Year >= 1970)
# OECD data
oecd = file.path(loc_data, "oecd.csv") %>% read.csv %>% 
  select("Country", "Year", tax_rate = "tax_rev_PC_GDP",
         union_density = "union_density.lin_inter",
         union_coverage = "union_coverage.lin_inter") %>% 
  subset(Country %in% country_set & Year >= 1970)
# Demographic data
demo = file.path(loc_data, "demo.csv") %>% read.csv %>% 
  select("Country", "Year", "young", "young_1564", "old", "dep", "n", "p") %>% 
  subset(Country %in% country_set)
## Merge
df0 = merge(pwt, oecd, all = TRUE) %>% merge(demo, all = TRUE) %>% 
  subset(Year >= 1970)
```

# Quantitative analysis {#quantitative}

This section provides a quantitative analysis of the model, with three main objectives: to reproduce the labor share dynamics observed over the period 1970 to 2010, to produce model predictions and to understand the transmission channels of demographic effects on the labor share. Based on analytical results, I compute quantitative predictions for France and the United-States.

```{r}
# Variable modifications
df1 = df0 %>%
  group_by(Country) %>% 
  mutate(L = emp * 1000,
         Y = rgdpna / avh * 1000, # AVH control
         K = rnna / avh * 1000, # AVH control
         theta = lab_sh1, # Labor share
         tau = tax_rate / 100, # Tax rate
         u = 1 - L/young_1564, # Unemployment rate
         p1 = lead(p, 40)) %>% 
  select(Country, Year, Ny = young, No = old, n, p, p1, dep, K, L, Y, theta, tau, u) %>% 
  # Normalized labor, capital and output
  mutate_at(vars("L", "K", "Y"), ~ {./first(.)}) %>% 
  # Normalized capital-labor ratio, young and old population
  mutate(k = K/L, Ny = L/(1-u), No = Ny*dep) %>% 
  ungroup() %>% 
  # Remove unused countries from Country levels
  mutate(Country = Country %>% as.character %>% factor)
```

```{r}
# Initial Sequence
init_seq = seq(1970, 2000, 10)

# Baseline data
data_base = df1 %>% 
  group_by(Country) %>% subset(Year %in% sim) %>% 
  select(Country, Year, Ny, No, n, p, p1, K) %>% 
  mutate(Sequence = ((sim - 1970)/10) %% 4 + 1, Period = (sim - init_seq) / 40 + 1) %>% 
  mutate_at(vars("Ny", "No", "K"), ~ ifelse(Year == 2010, NA, .)) %>% 
  # Complete NA values for p1 in 2070 and 2080
  mutate(
    p1 = ifelse(Year >= 2070, 
                p1[Year == 2060] + (Year - 2060)/10 * mean(p1/lag(p1)-1, na.rm = T), 
                p1), 
    ## Create empty variables
    eta = NA, AK = NA, AL = NA, k1 = NA, k2 = NA, k = NA, X = NA, L = NA, w = NA,
    r = NA, Y = NA, u = NA, theta = NA, tau = NA, b = NA, h = NA, S = NA) 

# Re-order variables
data_base = data_base %>% 
  select(Country, Year, Sequence, Period, Ny, No, n, p, p1, eta, AK, AL,
         k1, k2, k, X, L, w, r, Y, u, theta, tau, b, h, S, K)
```

```{r}
data = data_base %>% 
  # No biased technical change
  mutate(AK = 1, AL = 1) %>% 
  # Population dynamics
  demo_changer(init_spe = TRUE)
```

## Calibration {#calibration}

One period in the model corresponds to 40 years in the data. Following the methodology of @Gonzalez-Eiras2012 to simulate an OLG model, I compute four sequences of model predictions with a period length of 40 years each. Periods of the first sequence corresponds to 1970, 2010, 2050, ...; for the second sequence to 1980, 2020, 2060, ...; for the third sequence to 1990, 2030, 2070, ...; for the fourth sequence to 2000, 2040, 2080, .... When reporting time series predictions, I list the four sequences in a single time series.
With a period length of 40 years, agents are considered as young between 20 and 60 years of age and as elderly thereafter.^[An implicit assumption of the model is that the retirement age is constant (this assumption is discussed in section \@ref(discussion). The average French effective retirement age was 67.8 in 1970 and has declined to 59.3 in 2010. In the US it has gone from 68.4 to 65.6 over the same period (data from the [OECD Database, Ageing and Employment Policies - Statistics on average effective age of retirement](https://www.oecd.org/els/emp/average-effective-age-of-retirement.htm)). I suppose, as an approximation, that agents retire at 60 years-old to match the period lengths of the calibration. Such an assumption should not affect the voting outcome because almost-retired agents may anticipate their future situation once they vote. However, there could be implications in terms of labor supply. Nonetheless, a 5-year approximation remains marginal compared to the 40 years between the two periods. <!-- Justification/Argument to improve. -->] I compute the old-age dependency ratio from the data as the number of old people divided by the number of young people (i.e. $p_t/n_t \equiv N_t^o/N_t^y$). Then, the population growth rate at time $t$ is computed using the ratio between the number of young households in period $t$ relative to the number of young households in the previous period of the sequence (i.e. $n_t = N_t^y/N_{t-1}^y$). Finally, the survival rate at time $t$ is the product of the old-age-dependency ratio and the population growth.^[Demographic data from 1950 are taken from the [United Nations World Population Prospects 2017](https://population.un.org/wpp/). Demographic data before 1950 are from [http://www.populstat.info](http://www.populstat.info). Demographic data between 2010 and 2100 are the ``medium variant'' estimates from the United Nations. Both rates $n_t$ and $p_t$ converges to unity in the very long run (after the 5th period of the 4th sequence, hence 2160). However, I limit my analysis to 3 periods (hence 2080) due to high uncertainty above 100 years.] Figure \@ref(fig:demo) plots demographic variables for both countries.

```{r demo, fig.cap='Demographic variables time trends', fig.width=7, out.width='100%', fig.asp=.4, fig.align='center', dpi=200}
graph_demo = data %>% 
  mutate(dep = p/n) %>% select(Country, Year, n, p, dep) %>% setDT %>% 
  melt(id.vars = c("Country", "Year")) %>% 
  
  ggplot(aes(x = Year, y = value, color = Country)) +
  geom_line() +
  facet_wrap(. ~ variable, scales = "free_y",
    labeller = labeller(variable = c(n = "Population growth (n)", p = "Survival rate (p)",
                                     dep = "Old-age dependency ratio (p/n) "))) +
  scale_x_continuous(breaks = breaks_10_years,
                     labels = c(1970, "", "", 2000, "", "", 2030, "", "", 2060, "", "")) +
  theme_bw(base_size = 14) +
  labs(x = element_blank(), y = element_blank(), color = element_blank()) +
  theme(legend.position = "bottom")

if(knitr::is_html_output()){
  graph_demo +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  graph_demo +
    scale_color_grey(start = 0, end = .5)
}
```

```{r param}
# alpha and gamma
param_base = data.frame(
  "Country" = rep(c("France", "United States"), each = length(sim)),
  "Year" = sim, "alpha" = (0.99)^40, "gamma" = 0.5)

# Dataframe for estimation of sigma
df.sigma = df1 %>% 
  group_by(Country) %>% 
  mutate(k_log = log(k), THETA_log = log(theta/(1-theta)), t_diff = Year - first(Year)) %>% 
  select(Country, Year, k_log, THETA_log, t_diff) %>% 
  subset(Year %in% c(1970:2010)) %>% 
  ungroup()
### Regressions to estimate sigma
list.sigma = list(
  ## France
  France = list(
    # One for all
    all = lm(THETA_log ~ k_log + t_diff, data = df.sigma, 
             subset = Country == "France") %>% 
      coef %>% {1/(1+.[2])} %>% unname(),
    # Before 1985
    before85 = 1,
    # After 1985
    after85 = lm(THETA_log ~ k_log, data = df.sigma,
               subset = Country == "France" & Year > 1985) %>% 
      coef %>% {1/(1+.[2])} %>% unname()
  ),
  # United-States
  `United States` = list(
    all = lm(THETA_log ~ k_log, data = df.sigma, 
             subset = Country == "United States") %>% 
    coef %>% {1/(1+.[2])} %>% unname
    )
)
# Add production function parameters (sigma for all)
param_base = param_base %>%
  merge(df1 %>% subset(Year == 1970) %>% mutate(phi = 1-theta) %>% 
          select(Country, phi)) %>% 
  merge(data.frame(Country = c("France", "United States"),
                   sigma = c(list.sigma$France$all, 
                             list.sigma$`United States`$all))) %>% 
  mutate(a = NA)

# Compute omega and beta
param_base = param_base %>%
  merge(., df1) %>% 
  mutate(X = (sigma + (1-phi)/phi*(1-gamma*(1-sigma))/gamma*k^((1-sigma)/sigma))^(-1),
         eta = (1-phi)/phi*k^((1-sigma)/sigma) * ((Ny/K*k-1)*exp(-X) + 1),
         omega = n/p*(1+alpha*p1)/eta,
         beta = 1/(1 - tau)/(1-theta) - 1 - eta) %>% 
  group_by(Country) %>% 
  mutate(omega = first(omega), beta = first(beta)) %>% 
  select(Country, Year, alpha, gamma, phi, sigma, a, omega, beta) %>% 
  ungroup()

# Change sigma for France
param_base = param_base %>% 
  mutate(sigma = ifelse(Country == "France",
                        ifelse(Year <= 1980, list.sigma$France$before85,
                               list.sigma$France$after85), sigma))

## Grid search for A (Scale parameter)
# Set data
data = data_base %>% 
  # No biased technical change
  mutate(AK = 1, AL = 1) %>% 
  # Add parameters
  merge(param_base) %>% 
  # Demography
  demo_changer(AFinder = TRUE)
# A Finder script
source(file.path(loc_script, "sim_AFinder.R"))
# Assign A scale parameter to param_base
param_base$A = data$A
# Assign values
param = param_base
```

```{r print-param}
# Print parameters in the table
coef_summary = param_base %>% 
  subset(Year == 2010) %>% mutate_if(is.numeric, ~ round(., 3)) %>% 
  select(Country, phi, gamma, alpha, sigma, omega, beta, A) %>% 
  setDT %>% melt(id.vars = "Country") %>% 
  dcast(variable ~ Country, value.var = "value") %>% 
  mutate(
    variable = c("$\\phi$", "$\\gamma$", "$\\alpha$", "$\\sigma$", "$\\omega$", "$\\beta$", "A"),
    var_desc = c("Capital share in 1970", "Relative bargaining power of the union",
                 "Discount rate", "Capital-labor elasticity of substitution",
                 "Relative ideological spread-out", 
                 "Preference for government health expenditure", 
                 "Scale parameter of the production function")
  ) %>% 
  select(variable, var_desc, everything())

# Table infos
coef_table_col.names = c("", "Parameter", "France", "United States")
coef_table_footnote = "Single-equation estimation of σ from the two first-order conditions of the profit maximization with normalized CES production function. σ estimates are significant at p < 0.1 for France and p < 0.05 for the United States. Details in appendix \\@ref(app-C)."

if(knitr::is_html_output()){
  coef_table = coef_summary %>% 
    kable(caption = "Parameters", label = "param", col.names = coef_table_col.names, 
          booktabs = TRUE) %>% 
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
    footnote(general = coef_table_footnote, footnote_as_chunk = TRUE,)
  coef_table
}

if(knitr::is_latex_output()){
  coef_table = coef_summary %>% 
    kable(caption = "Parameters", label = "param", col.names = coef_table_col.names,
          format = "latex", booktabs = TRUE, linesep = "", escape = FALSE) %>% 
    footnote(general = coef_table_footnote, footnote_as_chunk = TRUE,
             escape = FALSE, threeparttable = TRUE)
  coef_table
}
```


Economic variables data ($K_t$, $emp_t$, $Y_t$, $\theta_t$) are taken from the [Penn World Table 9.1](https://www.rug.nl/ggdc/productivity/pwt/).^[$K$ is the capital stock at constant 2011 national prices, $emp$ the number of persons engaged, $Y$ the real GDP at constant 2011 national prices and $\theta$ the share of labor compensation in GDP. $K$ and $Y$ are adjusted with the average annual hours worked by persons engaged. For further details the reader is referred to @Feenstra2015.] When considering data on the labor share, I use the first adjustment method of @Feenstra2015.^[@Gollin2002 argues that it is necessary to take into account self-employed income. In the model, workers are only young individuals and provide only labor supply. Therefore, I assume that self-employed individuals earn an income that is characterized as a compensation.] I use government revenue as a share of GDP from the [OECD database](https://data.oecd.org/tax/tax-revenue.htm) as proxy for the tax rate $\tau_t$.
<!-- Unemployment and redistribution -->
In the model, labor supply is inelastic and there is no distinction between unemployed and inactive young individuals. Unemployed agents in terms of the model specification correspond to all agents that do not work. However, in high-income countries, such as France and United States, inactive individuals also benefits from redistribution. Therefore, I treat inactive individuals as unemployed and the redistribution is captured through unemployment benefits $b_t$ in the model.
I compute the unemployment rate such that $u_t = 1 - emp_t/N^{15-64}_t$, where $N_t^{15-64}$ is the working age population.^[I consider the whole working age population instead of the young population in order to compute the unemployment rate. Due to demographic specification of the model, young agents correspond to those between 20 and 60 years old. The number of persons engaged ($emp$) per age groups are not available in [PWT 9.1](https://www.rug.nl/ggdc/productivity/pwt/). Therefore, taking only $N^y_t$ as denominator would bias downward the unemployment rate. Results are robust to different specifications of the unemployment rate.]
<!-- \textbf{details in the Appendix (to be written)}.  -->
Then, I compute labor such that $L_t=(1-u_t)N_t^y$. I normalize $K_t$ and $L_t$ to their 1970 values. As a consequence, the capital-to-labor ratio $k_t$ is also normalized and is equal to 1 in 1970. Then, $N_t^y$ and $N_t^o$ are normalized such that $u_t$ matches the data in 1970.

<!-- Sigma estimation - Parameters to calibrate -->
Once all stock variables are normalized, I calibrate the seven remaining parameters $\lbrace \phi, \sigma, \gamma, \alpha, \omega, \beta, A \rbrace$. Table \@ref(tab:param) summarizes parameters for both countries.
% Parameters table
The first parameter $\phi$ corresponds to the capital share in 1970. Because the capital-labor ratio is normalized (i.e. $k_{1970} = 1$), the labor share $\theta$ in 1970 is equal to $1-\phi$, allowing me to determine $\phi$. I set the relative bargaining power of the union $\gamma$ to 0.5. Hence, I assume that neither the representative union nor the representative firm have any other advantage in the bargaining apart from their respective outside options. I also set the discount rate at 0.669 in line with the literature.

The main parameter of the model is the elasticity of substitution between capital and labor $\sigma$. I estimate it using a combination of the first order conditions of the profit maximization. Details of the estimation in [appendix C](app-C). I obtain 1.279 and 1.234, respectively, for France and the United States. According to the estimation, both input factors are gross substitute. These estimates are in line with @Karabarbounis2014 who use cross-sectional data on 50 countries over the period 1975-2012 to find an elasticity greater than 1 and on average around 1.28 in their baseline estimates. 

Then, I have three remaining parameters that are deduced. The relative ideological spread-out $\omega$ is set such that the model prediction matches the capital-to-labor ratio $k$ in 1970. The preference for government health expenditure $\beta$ is set to match the tax rate $\tau$ in 1970. Lastly, the scale parameter of the production function $A$ is set with grid-search to match the average labor share between 2008 and 2012 for each country.

Due to initial labor share values, the parameter distribution $\phi$ which correspond to the capital share in 1970 is larger in the United States than in France. Moreover, the relative per-capita political influence of old households $\omega$ is also greater. This deduced parameter suggests that young generations have less political weight in the United States compared to France. Notice that $\omega$ is lower than one for France. It implies that French youth voting behavior is more sensitive to policy changes compared to elderly. French households have a much greater preference for government health expenditure $\beta$. Finally, the scale parameter $A$ is ranged between 20 and 30 for both countries.

```{r breakers}
breakers = demo %>% 
  ## Compute demographic data for 1960
  subset(Year == 1960) %>% 
  mutate(Sequence = NA, Period = NA, Ny = NA, No = NA, p1 = NA) %>% 
  select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
  rbind(., data_base %>% 
          select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
          subset(Year == 2000) %>% 
          ungroup()) %>% 
  group_by(Country) %>% 
  mutate(p1 = ifelse(Year == 1960, dplyr::lead(p), p1),
         Ny = ifelse(Year == 1960, dplyr::lead(Ny)/dplyr::lead(n), Ny),
         No = ifelse(Year == 1960, p/n*Ny, No),
         Sequence = ifelse(Year == 1960, 4, Sequence),
         Period = ifelse(Year == 1960, 0, Period)) %>% 
  subset(Year == 1960) %>% 
  ungroup() %>% 
  ## Demographic data for 1960 : done
  rbind(., data_base %>% 
          select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
          ungroup()) %>% 
  arrange(Country) %>% 
  merge(., param_base %>% select(Country, alpha, omega) %>% unique()) %>% 
  group_by(Country, Sequence) %>% 
  mutate(eta = n/p*(1+alpha*p1)/omega,
         Ny = ifelse(Period == 2, lag(Ny,1)*n, Ny),
         No = ifelse(Period == 2, lag(Ny,1)*p, No),
         Ny = ifelse(Period == 3, lag(Ny,1)*n, Ny),
         No = ifelse(Period == 3, lag(Ny,1)*p, No),) %>% 
  select(-alpha, -omega) %>% 
  ungroup()
```

```{r}
list.sim = list()
```

```{r baseline}
# Specification
spe = "baseline"

# Initialize result dataset
final = data.frame(matrix(ncol = ncol(data)+ ncol(param) -2 + 1, nrow = 0)) %>%
  setNames(c("Specification", names(data), names(param)[-c(1,2)]))

# Prepare data for simulation
data = data_base %>% 
  # Merge with parameters
  merge(param) %>% 
  # No BTC
  mutate(AK = 1, AL = 1) %>% 
  # Demography
  demo_changer() %>% 
  # Define specification model
  mutate(Specification = spe) %>%
  # Reorder variables
  select(Specification, everything())

# Prepare result data frame to loop on
result = final

# Simulate the baseline model for each country
for(country in country_set){
    result = data %>%
      subset(Country == country) %>% 
      model(time = 3) %>% 
      rbind(result, .)
}

# Regroup result
list.sim$baseline = result
```

## Model predictions over the period 1970-2010 {#pred7010}

Figure \@ref(fig:baseline7010) displays the labor share over the period 1970-2010, depicting both model predictions and the data.

```{r baseline7010, fig.cap='Model prediction of the labor share (1970-2010)', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
baseline7010_LS = list.sim$baseline %>% select(Country, Year, theta) %>% setDT %>% 
  melt(id.vars = c("Country", "Year")) %>% 
  rbind(df1 %>% select(Country, Year, theta) %>% setDT %>% 
          melt(id.vars = c("Country", "Year")) %>% mutate(variable = "data")
        ) %>% 
  filter(complete.cases(.)) %>% 
  subset(Year %in% c(1970:2010)) %>% 
  mutate(variable = factor(variable, levels = c("data", "theta"))) %>% 
  
  ggplot(aes(x = Year, y = value, color = Country, linetype = variable)) +
  geom_line() +
  scale_linetype_discrete(label = c("Data", "Model prediction")) +
  labs(x = element_blank(), y = element_blank(), 
       title = "Labor share",
       linetype = element_blank(), color = element_blank()) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom")
  
  
if(knitr::is_html_output()){
  baseline7010_LS +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  baseline7010_LS +
    scale_color_grey(start = 0, end = .5)
}
```

The model reproduces the trend in the data for both countries. 
<!-- United-States -->
For the United States, the model tends to overestimate the labor share in 1980 and 1990 and underestimate it in 2000.
<!-- Explanations / References ? -->
However, model predictions capture the global trend of the labor share over the period.
<!-- France -->
For France, the dashed curve is the model prediction with a capital-labor elasticity of substitution of 1 in 1970-1980 and about 1.321 thereafter. The scale parameter $A$ is also changed to 23.891 for France. The initial calibration of the model, as in section \@ref(calibration), is not able to reproduce the large decline in the labor share between 1980 and 1990. This may be explained by factors not considered in the model.
<!-- Firing cost : Bentolila and Bertola -->
I model the workers outside option within the wage bargaining using only unemployment benefits and the tax rate but other labor market institutions may have played a role in firms' employment policies during this period. For example, in my framework, there is no firing cost. @Bentolila1990 argue that firing costs have an effect on firms' propensity to hire and fire, and thus on employment levels. Further, they also find that firing costs slightly increase average long-run employment. Subsequent to the oil shock, firms were not able to fire as they would have due to high firing costs.^[@Blanchard1997 also shows that wages failed to adjust to the productivity slowdown and adverse supply shocks of the 1970s. Thus, wages remained relatively high and so did the labor share. This phenomenon was more pronounced in Continental European countries than in the Anglo-Saxon countries, mainly due to labor market institutions.] They reduced employment with attrition, thus the process took time and the employment remained higher than it should during some years. In addition, most of the employment security policies were introduced between the 1960s and the beginning of the 1970s. Here again, these protections may be the result of the baby-boomers generation operating a political pressure to secure employment. Although, I do not integrate it in the model. Then, France during the 1980s has started to implement policies in order to make the labor market more flexible. For instance, short term contracts have been introduced in 1979. To summarize, the labor market institutions in France were tremendously different before and after the 1980s. The reason why the model prediction does not reproduce the labor share in the data owes to the calibration of the model that is in line with the labor market institutions after 1980, but not before. Another way to think about it, in terms of the model, is to suppose that the capital-labor elasticity of substitution was much smaller before 1980.^[Perhaps even lower than 1, meaning that an increase in $k_t$ leads to an increase in $\theta_t$.] Therefore, the representative firm was constrained and not able to substitute labor by capital as much as the model predicts.
In line with the above arguments, I investigate whether there is a change in the regime of $\sigma$ over this period. Details of the methodology are provided in [appendix D](app-D). I find that such a break has occurred during the 1980s in France. 

<!-- Transition Mechanism analysis -->
To highlight the mechanisms of the declining labor share, it is necessary to look at the variations of determinant variables. 
Figure \@ref(fig:dev7010) displays the deviation from the 1970's value of determinant variables in percentage. 

```{r dev7010, fig.cap='Deviation from the initial value of the determinant variables', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
dev7010 = list.sim$baseline %>% 
  group_by(Country) %>% 
  mutate(outside = b/(1-tau)) %>% 
  select(Country, Year, eta, outside, w, L, u, K, Y) %>% 
  mutate_at(vars(eta, outside, w, L, u, K, Y), ~ ./.[Year == 1970]-1) %>% 
  subset(Year %in% c(1970: 2010)) %>% 
  # Variables and names
  select(Country, Year,
         "Youth~political~power~(eta)" = eta,
         # "Outside~option" = outside,
         "Wage~rate~(w)" = w, 
         "Labor~(L)" = L, 
         "Unemployment~rate~(u)" = u,
         # "Capital~(K)" = K,
         "Output~(Y)" = Y) %>% 
  setDT %>% melt(id.vars = c("Country", "Year")) %>% 
  
  ggplot(aes(x = Year, y = value, color = Country)) +
  geom_hline(yintercept = 0, linetype = "dotted") +
  geom_line() +
  facet_wrap(. ~ variable, scales = "free", nrow = 2,
             labeller = label_parsed) +
  scale_x_continuous(breaks = seq(1970, 2010, 10),
                     labels = c("1970","", "1990", "", "2010")) +
  labs(x = element_blank(), y = element_blank(), color = element_blank()) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.95, 0.4), legend.justification = c(1,1),
        panel.spacing.x = unit(1, "lines"))

if(knitr::is_html_output()){
  dev7010 +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  dev7010 +
    scale_color_grey(start = 0, end = .5)
}
```

The equilibrium of the economy is determined by the interaction of the wage bargaining and the voting. Both processes take place simultaneously. The demographic context over this period is presented in figure \@ref(fig:demo). The population growth $n_t$ slightly exceeds the increasing survival rate $p_t$ between 1970 and 2000. Thus, the old-age-dependency ratio $p_t/n_t$ remains roughly constant. With a decline in France in 1980 due to the massive entry of the baby-boomers in the labor force. The old-age-dependency ratio starts to increase between 2000 and 2010 due to a steady population growth but a sharply increasing survival rate. This increase is also due to the baby-boomers' cohort starting to retire. As a result of this demographic context, the youth political weight $\eta_t$ was above its 1970's level until 2000 in both countries.

As the youth's political weight rises and because they desire more redistribution, the tax rate $\tau_t$ increases. Due to the opportunistic behavior of political parties, pro-youth policies are implemented. In the model, pro-youth policies correspond to pro-labor policies and are translated in terms of unemployment benefits in order to insure the unemployment risk. Thus, the unemployment benefits share in government revenue increases at the cost of the government health spending share in government revenue. These policy changes interact with the wage bargaining because they affect the outside option of the young agents. Pro-youth public policies motivated by a higher youth political weight leads to an increase of the unemployment benefits and a decline of the disposable income rate $(1-\tau_t)$. These two variables determine the outside option $b_t/(1-\tau_t)$ within the wage bargaining. The decrease of the denominator exceeds the increase of the numerator. Thus, the net effect on the outside option is positive and allows workers to bargain a greater wage $w_t$. The gain in net wage $(1-\tau_t)w_t$ exceeds the one in unemployment benefits per capita $b_t$. Hence, employment is even more worth as unemployment in terms of utility, i.e. $dX_t > 0$. Due to the ability of workers to bargain a greater wage, the representative firm shifts away from labor.  This behavior is permitted by two features of the model. First, the right-to-manage specification of the wage bargaining enables the firm to hire and fire as much as wanted. Second, the capital-labor elasticity of substitution $\sigma$ is greater than unity for both countries. Thus, both input factors are gross substitutes. The firm is able to substitute labor with capital for a given output level. This behavior leads to a decline of the number of workers $L_t$ because the labor cost (i.e. the wage) has increased. Notice that the substitution effect is more vigorous in France because of the relatively higher elasticity of substitution $\sigma$. The French economy has a faster growth in capital stock $K_t$, while French firms are able to substitute relatively more labor with capital. Thus, the number of workers becomes lower than its 1970's level in France. While the United-States manage to slightly increase its labor factor. As a consequence, the US output $Y_t$ grows faster.
The slowdown in employment has consequences on the labor market. 
This slowdown in employment directly raises unemployment in France by reducing the number of workers. Furthermore, the effect is all the more tremendous because the labor force $N_t^y$ grows due to the baby-boomers' arrival. The United-States also know a growing population but the impact on unemployment is much weaker due to the increasing number of workers, as discussed above.
The dynamics of the production function affects the determinants of the labor share. 
Due to the fact that both input factors are gross substitute, the output-per-worker $Y_t/L_t$ increases when the capital-per-worker $k_t$ does so. This increase exceeds the one of the wage. As a result, the labor share declines.
Let us summarize the mechanisms over this period. The baby-boomers change labor market institutions in their favor due to their relatively high political weight. It raises the outside option of workers, giving more bargaining power to the union who is able to bargain greater wages. The cost of labor becoming too high, the firms decide to shift away from labor. The fact that both input factors are gross-substitutes allows firms to substitute labor with capital. The shift away from labor engenders an increase in output per worker which thwarts and exceeds the wage gain. Thus, the labor share declines. 
<!-- Moreover, unemployment rises due to a growing labor force. -->

## Model predictions over the period 2010-2080 {#pred1080}

<!-- %% Description of the graph -->
Figure \@ref(fig:baseline1080) displays the labor share predicted by the model for the period 2010-2080.

```{r baseline1080, fig.cap='Model prediction of the labor share (2010-2080)', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
baseline1080_LS = list.sim$baseline %>% select(Country, Year, theta) %>% setDT %>% 
  melt(id.vars = c("Country", "Year")) %>% 
  rbind(df1 %>% select(Country, Year, theta) %>% setDT %>% 
          melt(id.vars = c("Country", "Year")) %>% mutate(variable = "data")
        ) %>% 
  filter(complete.cases(.)) %>% 
  mutate(variable = factor(variable, levels = c("data", "theta"))) %>% 
  
  ggplot(aes(x = Year, y = value, color = Country, linetype = variable)) +
  geom_line() +
  scale_linetype_discrete(label = c("Data", "Model prediction")) +
  labs(x = element_blank(), y = element_blank(), 
       title = "Labor share",
       linetype = element_blank(), color = element_blank()) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom")
  
  
if(knitr::is_html_output()){
  baseline1080_LS +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  baseline1080_LS +
    scale_color_grey(start = 0, end = .5)
}
```

The model predicts that the labor share should continue to decline after 2010 in both countries. However, France should face a slight rise in 2030 up to 66.1% before shrinking again. While the US labor share should remain stable around 62.6 % between 2010 and 2040 and then follows the same pattern. Figure \@ref(fig:dev1080) displays the deviation from the 1970's value of determinant variables in percentage. 

```{r dev1080, fig.cap='Deviation from the initial value of the determinant variables', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
dev1080 = list.sim$baseline %>% 
  group_by(Country) %>% 
  mutate(outside = b/(1-tau)) %>% 
  select(Country, Year, eta, outside, w, L, u, K, Y) %>% 
  mutate_at(vars(eta, outside, w, L, u, K, Y), ~ ./.[Year == 2010]-1) %>% 
  subset(Year %in% c(2010: 2080)) %>% 
  # Variables and names
  select(Country, Year,
         "Youth~political~power~(eta)" = eta,
         # "Outside~option" = outside,
         "Wage~rate~(w)" = w, 
         "Labor~(L)" = L, 
         "Unemployment~rate~(u)" = u,
         # "Capital~(K)" = K,
         "Output~(Y)" = Y) %>% 
  setDT %>% melt(id.vars = c("Country", "Year")) %>% 
  
  ggplot(aes(x = Year, y = value, color = Country)) +
  geom_hline(yintercept = 0, linetype = "dotted") +
  geom_line() +
  facet_wrap(. ~ variable, scales = "free", nrow = 2,
             labeller = label_parsed) +
  scale_x_continuous(breaks = seq(2010, 2080, 10),
                     labels = c("2010","", "2030", "", "2050", "", "2070", "")) +
  labs(x = element_blank(), y = element_blank(), color = element_blank()) +
  theme_bw(base_size = 14) +
  theme(legend.position = c(0.95, 0.4), legend.justification = c(1,1),
        panel.spacing.x = unit(1, "lines"))

if(knitr::is_html_output()){
  dev1080 +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  dev1080 +
    scale_color_grey(start = 0, end = .5)
}
```

The demographic context over the period 2010-2080, as presented in figure \@ref(fig:demo), is roughly the same for France and the United-States in terms of dynamics. Although the magnitudes are not similar. The population growth $n_t$ faces a sharp decline between 2010 and 2050 before stabilizing thereafter. Meanwhile, the survival rate $p_t$ grows by around 4% per decade. Thus, the old-age-dependency ratio increases up to 2050, more in France than in the United-States. Once the population growth becomes stable, the ratio still grows but at a lower rate. This aging of the population is mainly due to the baby-boomers' retirement. As a result, the youth political weight never gets back to its 2010's level and will strongly decline up to 2050 for both countries.

<!-- The story is the opposite of the period 1970-2010. -->

The young political weight $\eta_t$ sharply declines due to the aging of the population. Thus, opportunistic political candidates favor old individuals who desire less redistribution, i.e. $\partial\tau_t / \partial \eta_t > 0$. Pro-elderly public policies are implemented. In terms of the model, it is translated by an increase of the health spending share in government revenue at the cost of the unemployment benefits one.
These policy changes interact with the wage bargaining because they affect the outside option of young households. 
Pro-elderly public policies leads to slightly weaken the outside option $b_t/(1-\tau_t)$ within the wage bargaining for both countries between 2010 and 2050. Workers are no longer in position to bargain greater wages and have to concede a wage cut. But the declining wage goes along with a lowering of the tax rate which diminishes the impact on the net wage. Hence, having a job between 2010 and 2050 is worth less in terms of utility than it was in 2010. In both countries, the outside option rises over the period 2050-2080 and so does the bargained wage. This increase is mainly due to the disappearance of baby-boomers. Thus, the age-related conflict within the public policy becomes relatively more in favor of the youth again.
As the wage decreases between 2010 and 2050, the representative firm has incentive to hire. Thus, the labor $L_t$ does increase over this period. Meanwhile, the capital stock $K_t$ has increased due to savings $S_t$ of the previous periods. Thus, both factors increase and so does the output $Y_t$. After 2050, France and the United-States diverge in their trajectories. On one hand, the US capital stock rises due to high savings of the previous periods.^[This increase in savings owes to the baby-boomers cohort when they were young. Their massive entry on the labor market, rising expected life expectancy and higher wages have fostered savings and therefore the capital available in the economy once old.] This rise is strong enough to foster the representative firm to hire workers. Thus, the substitution mechanism does not operate. On the other hand, the increase of the French capital stock does not follow the same exploding pattern. The french representative firm, as during the end of the twentieth century, shifts away from labor and decreases the number of workers. This divergence also appears on the labor market.
The labor force $N^y_t$ is roughly constant over the whole period and France is even below its 2010's level. Thus, variations in the number of workers mainly drives the unemployment ones. The unemployment rate decreases in the United-States over the whole period. It falls down to 1.69% by 2080 against 44.6% in 2010. Here again, the sharp increase of the capital stock fosters employment until almost full-employment. The French unemployment rate decreases until 2050 before to slightly rise a bit and stabilize itself around 26.9% in 2080.
French and US workers experience a minor reduction of their wage $w_t$ between 2010 and 2050 and so does the output per worker $Y_t/L_t$. The latter being greater than the former, the French labor share slightly increases. The US labor share remains constant because both variations compensate. After 2050, both labor shares decline to reach 62% and 59.8%, respectively for France and the United-States. While their respective levels in 2010 were 65.1% and 62.5%.

## Counterfactual and aging effect decomposition {#counterfactual}

So far, I have highlighted the different mechanisms through which the age structure of the population affects economic variables and therefore the labor share. I now consider the previous model's prediction as the benchmark prediction. For the French case, I envisage the model specification with a break in the regime of $\sigma$. To summarize, demographic changes are due to two determinant variables in the model : the population growth $n_t$ and the survival rate $p_t$. These variations may affect the labor share through two channels : the direct cohort effect and the indirect cohort effect $\eta_t$.

I make counterfactual predictions in order to quantity the respective role of each channel. The idea is to neutralize either a determinant of the demographic change or a channel through which the labor share is affected. The intuition behind the counterfactual is to observe what would have happened in terms of model predictions if this effect/channel was neutralized. By comparing a counterfactual simulation to the benchmark one, I can quantify its extent. I proceed in two steps. First, I examine the impact of the different determinants of demographic changes (i.e. $n_t$ versus $p_t$). Second, I investigate through which channels it occurs (i.e. direct versus indirect).

## Survival rate and population growth effects {#srpg}

To neutralize the impact of the survival rate $p_t$, I assume that it remains at its 1970's level. Thus, $p_t = p_{1970}$ and $p_{t+1} = p_{2010}$. Population size is recalculated such that ${N^o_t}^\prime = N_t^o\times\frac{p_{1970}}{p_t}$. Moreover, $\eta_t = \frac{n_t}{p_{1970}}\frac{1+\alpha p_{2010}}{\omega}$.
<!-- ^[For the first sequence of the model: 1970, 2010, 2050,... . The expected survival rate $p_{t+1}$ in 1970 is not equal to $p_{1970}$ but to $p_{2010}$. This exception is done in order to match the benchmark simulation in 1970 and thus share the same fixed point. Otherwise, $\eta^{\text{bench.}}_{1970} \neq \eta^{p}_{1970} \Rightarrow k^{\text{bench.}}_{1970} \neq k^{p}_{1970} \Rightarrow \theta^{\text{bench.}}_{1970} \neq \theta^{p}_{1970}$, where $^\text{bench.}$ stands for the benchmark simulation and $^p$ for the constant survival rate simulation.] -->
The other demographic variables (i.e. $n_t$ and $N^y_t$) follow the time series of the benchmark simulation. The initial capital stocks of the four sequences are also recalculated such that $K_0^\prime = \frac{1+\alpha p_t}{p_t}\frac{p_{1970}}{1+\alpha p_{1970}} K_0$.^[Setting constant the survival rate implies changes in the saving rate through the expected survival rate $p_{t+1}$. Thus, $K_0 \equiv S_{-1} = \frac{\alpha p_0}{1+\alpha p_0}\left[(1-\tau_{-1})w_{-1}(1-u_{-1})+b_{-1}u_{-1}\right]N_{-1}^y$. In order to assess the true impact of the survival rate, it is also necessary to consider saving rate changes in the counterfactual simulation. Thus, the initial capital stocks for the first periods of the four sequences becomes $K_0^\prime = \frac{1+\alpha p_t}{p_t}\frac{p_{1970}}{1+\alpha p_{1970}} K_0$. Notice that a change in the survival rate $p_0$ should also affect the aggregated disposable income of young households in $t=-1$, i.e. $(1-\tau_{-1})w_{-1}(1-u_{-1})+b_{-1}u_{-1}$. However, I do not consider this source of change. Notice also that the term $N_{-1}^y$ does not change because $N_{-1}^y = \frac{N_0^o}{p_0} = \frac{{N_0^o}^\prime}{p_{1970}}$.] The methodology is analogous to neutralizing the impact of the population growth but with $n_t = n_{1970}$, ${N_t^y}^\prime = N_t^y\times\frac{n_{1970}}{n_t}$ and $\eta_t = \frac{n_{1970}}{p_t}\frac{1+\alpha p_{t+1}}{\omega}$.^[In this specification, the initial capital stocks are not changed because $n_0$ does not affect $S_{-1}$.] Finally, a last counterfactual is made to neutralize both effects. So, $p_t = p_{1970}$, $p_{t+1} = p_{2010}$, $n_t = n_{1970}$ and $\eta_t = \eta_{1970}$. As before, population sizes and initial capital stock values are recalculated.
<!-- ^[The same exception, as explained in the previous footnote, is done to ensure that the labor share in matched in 1970.] -->
Here, the old-age-dependency ratio remains constant. Table \@ref(tab:demo70) summarizes the demographic variables in 1970.

```{r}
demo70 = list.sim$baseline %>% subset(Year == 1970) %>% mutate(dep = p/n) %>% 
  select(Country, p, n, p1, dep, eta) %>% setDT %>% 
  melt(id.vars = "Country", variable.name = "var") %>% 
  dcast(var ~ Country, value.var = "value") %>% 
  mutate(
    "var" = c("$p_{1970}$", "$n_{1970}$", "$p_{2010}$",
              "$\\frac{p_{1970}}{n_{1970}}$", "$\\eta_{1970}$"),
    "Variable" = c("Survival rate in 1970", "Population growth in 1970",
                        "Expected survival rate in 2010", "Old-age-dependency ratio in 1970",
                        "Youth political power in 1970")) %>% 
  mutate_if(is.numeric, ~ round(., 3)) %>% 
  select(var, Variable, everything())

# Table infos
demo70_table_col.names = c("", "Variable", "France", "United States")
# demo70_table_footnote = ""

if(knitr::is_html_output()){
  demo70_table = demo70 %>% 
    kable(caption = "Demographic variables in 1970", 
          label = "demo70", col.names = demo70_table_col.names, 
          booktabs = TRUE) %>% 
    kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE)
  demo70_table
}

if(knitr::is_latex_output()){
  demo70_table = demo70 %>% 
    kable(caption = "Demographic variables in 1970", 
          label = "demo70", col.names = demo70_table_col.names,
          format = "latex", booktabs = TRUE, linesep = "", escape = FALSE)
  demo70_table
}
```

```{r}
# Re initialize result data frame
result = result[0,]
# Define break_year
break_year = 1970

## Aging effect decomposition : Survival rate versus Population growth
  for(sr in c("TSR", "FSR")){
    for(pg in c("TPG", "FPG")){
      
      # Simulation name
      spe = paste0("counter_", break_year, "_", pg, ".", sr, ".", "TDE", ".", "TIE")
      
      # Prepare data
      data = data_base %>% 
      # No biased technical change
      mutate(AK = 1, AL = 1) %>% 
      # Add parameters
      merge(param) %>% 
      # Demography
      demo_changer(break_year = break_year, p1_equals_p_fix = FALSE, PG = pg, SR = sr) %>% 
      # Define specification model
      mutate(Specification = spe) %>%
      # Reorder variables
      select(Specification, everything())
      
      # Simulate the model for each country
      for(country in country_set){
          result = data %>%
            subset(Country == country) %>% 
            model(time = 3) %>% 
            rbind(result, .)
      }
    }
  }

## Aging effect decomposition : Direct effect versus Indirect effect
  for(de in c("TDE", "FDE")){
    for(ie in c("TIE", "FIE")){
      
      # Simulation name
      spe = paste0("counter_", break_year, "_", "TPG", ".", "TSR", ".", de, ".", ie)
      
      # Prepare data
      data = data_base %>% 
      # No biased technical change
      mutate(AK = 1, AL = 1) %>% 
      # Add parameters
      merge(param) %>% 
      # Demography
      demo_changer(break_year = break_year, p1_equals_p_fix = FALSE, DE = de, IE = ie) %>% 
      # Define specification model
      mutate(Specification = spe) %>%
      # Reorder variables
      select(Specification, everything())
      
      # Simulate the model for each country
      for(country in country_set){
          result = data %>%
            subset(Country == country) %>% 
            model(time = 3) %>% 
            rbind(result, .)
      }
    }  }


# Remove duplicates
final = distinct(result)

# Model specification details
final = final %>% mutate(PG = ifelse(grepl("TPG", Specification), "TPG", "FPG"),
                 SR = ifelse(grepl("TSR", Specification), "TSR", "FSR"),
                 DE = ifelse(grepl("TDE", Specification), "TDE", "FDE"),
                 IE = ifelse(grepl("TIE", Specification), "TIE", "FIE"),
                 break_year = as.numeric(gsub("[^0-9]", "\\1", Specification))) %>% 
  select(Specification, break_year, PG, SR, DE, IE, everything())
```

```{r}
# Dataframe to compare the LS counterfactual
decomp = final %>% 
  select(Country, Specification, Year, theta) %>% 
  rbind(., 
        df1 %>% 
          mutate(Specification = paste0("data_", break_year)) %>%
          select(Specification, Country, Year, theta))  %>% 
  mutate(from = ifelse(!grepl("data", Specification), "sim", "data")) %>%
  filter(complete.cases(.)) %>% 
  mutate(PG = ifelse(from == "data", NA, ifelse(grepl("TPG", Specification), "TPG", "FPG")),
         SR = ifelse(from == "data", NA, ifelse(grepl("TSR", Specification), "TSR", "FSR")),
         DE = ifelse(from == "data", NA, ifelse(grepl("TDE", Specification), "TDE", "FDE")),
         IE = ifelse(from == "data", NA, ifelse(grepl("TIE", Specification), "TIE", "FIE")),
         break_year = as.numeric(gsub("[^0-9]", "\\1", Specification))) %>% 
  select(Specification, break_year, PG, SR, DE, IE, everything())

```

```{r}
# Dataframe for decomposition
decomp2 = decomp %>% subset(from == "sim") %>% 
  mutate(Spe_PGSR = interaction(PG, SR), Spe_DEIE = interaction(DE, IE)) %>% 
  select(Country, Year, break_year, Spe_PGSR, Spe_DEIE, theta) %>% setDT %>% 
  dcast(Country + Year + break_year ~ Spe_PGSR + Spe_DEIE, value.var = "theta") %>% 
  setNames(c("Country", "Year", "break_year",
             "FPG.FSR", "TPG.FSR", "FPG.TSR", "FDE.FIE", "TDE.FIE", "FDE.TIE",
             "benchmark")) %>% 
  mutate(FPG.TSR = (benchmark - FPG.TSR)*100,
         TPG.FSR = (benchmark - TPG.FSR)*100,
         FPG.FSR = (benchmark - FPG.FSR)*100,
         FPG.FSR = FPG.FSR - FPG.TSR - TPG.FSR,
         position_PGSR = (FPG.TSR + TPG.FSR + FPG.FSR),
         FPG.TSR.share = abs(FPG.TSR)/(abs(FPG.TSR) + abs(TPG.FSR) + abs(FPG.FSR)),
         TPG.FSR.share = abs(TPG.FSR)/(abs(FPG.TSR) + abs(TPG.FSR) + abs(FPG.FSR)),
         FPG.FSR.share = abs(FPG.FSR)/(abs(FPG.TSR) + abs(TPG.FSR) + abs(FPG.FSR)),
         FDE.TIE = (benchmark - FDE.TIE)*100,
         TDE.FIE = (benchmark - TDE.FIE)*100,
         FDE.FIE = (benchmark - FDE.FIE)*100,
         FDE.FIE = FDE.FIE - FDE.TIE - TDE.FIE,
         position_DEIE = (FDE.TIE + TDE.FIE + FDE.FIE),
         FDE.TIE.share = abs(FDE.TIE)/(abs(FDE.TIE) + abs(TDE.FIE) + abs(FDE.FIE)),
         TDE.FIE.share = abs(TDE.FIE)/(abs(FDE.TIE) + abs(TDE.FIE) + abs(FDE.FIE)),
         FDE.FIE.share = abs(FDE.FIE)/(abs(FDE.TIE) + abs(TDE.FIE) + abs(FDE.FIE))) %>% 
  setDT %>% 
  melt(id.vars = c("Country", "Year", "break_year", "position_PGSR", "position_DEIE"))

```

Figure \ref{fig:counter-pgsr} displays the model predictions of the labor share with counterfactual specifications.

```{r counter-pgsr, fig.cap='Model predictions of the labor share with counterfactual specifications', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
# Counterfactual graphic parameters
pgsr_labels = c("Data", "Benchmark", expression(n[1970]), expression(p[1970]),
               expression(p[1970]*", "*n[1970]))

## Counterfactual PGSR
counter_pgsr = decomp %>% 
  subset(DE %in% c("TDE", NA) & IE %in% c("TIE", NA)) %>%
  mutate(PGSR = interaction(PG, SR) %>% as.character %>%
           ifelse(is.na(.), "data", .)) %>% 
  mutate(PGSR = factor(PGSR,
                       levels = c("data", "TPG.TSR", "FPG.TSR", "TPG.FSR", "FPG.FSR"))) %>% 
  
  ggplot(aes(x = Year, y = theta, color = PGSR, linetype = PGSR)) +
  facet_wrap(Country ~ .) +
  geom_line() +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom",) +
  labs(x = element_blank(), y = element_blank(), title = "Labor share",
       color = element_blank(), linetype = element_blank())

if(knitr::is_html_output()){
  counter_pgsr +
  scale_linetype_manual(labels = pgsr_labels, values = c("solid", rep("dashed", 4))) +
  scale_color_manual(labels = pgsr_labels, 
                     values = c("black", brewer.pal(8, "Set1")[c(1:4)]))
}
 
if(knitr::is_latex_output()){
  counter_pgsr +
    scale_linetype_manual(labels = pgsr_labels, 
                          values = c("solid", "dashed", "twodash", "dotted", "solid")) +
    scale_color_manual(labels = pgsr_labels, 
                       values = c("grey", rep("black", 4)))
}

```

To interpret the role played by each demographic variable, I compare each counterfactual time series to the benchmark one. For instance, let us start with the impact of the survival rate in France. I look at the dashed curve with respect to the solid one. This curve corresponds to the counterfactual where the survival rate $p_t$ and $p_{t+1}$ remain at their 1970's levels. So, if the survival rate would have not changed, then the labor share would have followed the dashed curve pattern. 
<!-- The blue curve lies below the red one between 1980 and 2020 and above thereafter. Therefore, the survival rate dynamic had a positive impact on the labor share between 1980 and 2020 and a negative one thereafter. -->
The dashed curve lies below the solid one. Therefore, the survival rate dynamic has a positive impact on the labor share in both countries.
The way to interpret the other counterfactuals is similar.
The dash-dotted curve remains above the solid one until 2050 for France and 2030 for the United States. Until these years, the population growth dynamic has a negative impact on the labor share and a positive one thereafter.
Finally, the dotted curve which corresponds to the counterfactual where both effects are neutralized is below the benchmark simulation. Since 1970, all demographic dynamics have led to increase the labor share with respect to what it would have been without these dynamics.
However, this representation is tediously legible. Therefore, I compute the distance between the benchmark labor share and each counterfactual labor share. Using the Chasles' relation within an affine space at each point in time, it is possible to isolate the extent of each effect.^[Let $r$ (resp. $b, g, p$) be the labor share from the red (resp. blue, green, purple) curve on figure \@ref(fig:counter-pgsr). For a given year, $2\vec{rp} = \vec{rb} + \vec{bp} + \vec{rg} + \vec{gp} \Leftrightarrow \vec{rp} = \vec{rb} + \vec{rg} + \vec{\text{int.}}$, where $\vec{\text{int.}} \equiv \vec{bp} + \vec{gp} - \vec{rp} = \vec{gp} +\vec{br} = \vec{bp} + \vec{gr}$ is the interaction of both effects defined as the part which is not exclusively explained by both effects independently.] Figure \@ref(fig:decomp-pgsr) displays the labors share's gap between the benchmark and the counterfactuals in percentage points.

```{r decomp-pgsr, fig.cap='Aging-effect decomposition by determinant', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
# Labels
pgsr_labels2 = c("Population growth effect", "Survival rate effect", "Interaction effect")

## PGSR Decomposition
decomp_pgsr = decomp2 %>%
  subset(variable %in% c("FPG.TSR", "TPG.FSR", "FPG.FSR")) %>%
  mutate(variable = factor(variable, levels = c("FPG.TSR", "TPG.FSR", "FPG.FSR"))) %>%
  
  ggplot(aes(x = Year)) +
  geom_col(aes(y = value, fill = variable), alpha = .7, 
           position = position_stack(reverse = TRUE)) +
  geom_hline(yintercept = 0, linetype = "dotted") +
  facet_wrap(Country ~ .) +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  theme(legend.direction = "horizontal", legend.box = "horizontal", legend.position = "bottom",
        axis.title.x = element_blank()) +
  labs(x = element_blank(), y = element_blank(), fill = element_blank(),
       title = "Difference with counterfactual (in pp.)")

if(knitr::is_html_output()){
  decomp_pgsr +
    geom_line(aes(y = position_PGSR), color = brewer.pal(8, "Set1")[1]) +
    scale_fill_manual(labels = pgsr_labels2, 
                      values = brewer.pal(8, "Set1")[c(2:4)])
}
 
if(knitr::is_latex_output()){
  decomp_pgsr +
  geom_line(aes(y = position_PGSR), color = "black") +
    scale_fill_grey(labels = pgsr_labels2, start = .1, end = .8)
}

```

As mentioned above, the survival rate effect has kept the labor share relatively high in both countries. Another way to think about that is to consider demographic dynamics in terms of cohort sizes. Until 2010, if the survival rate had been held constant, then the massive increase in the population of young households due to the baby-boomers' presence would have generated an even larger decline of the labor share. However, the aging population (i.e. the increase of the survival rate) has thwarted part of this fall. Notice that the difference with the counterfactual is less than 1% in the case of the United-States. It suggests that the aging phenomenon over this period is a larger determinant of the labor share in France compared to the United-States.
<!-- After 2010, the explanation power of the survival rate falls and the distance between the benchmark simulation with respect to the counterfactual shrinks. It corresponds to the fact that demographic variations are not as wide as during the end of the 20th century. -->
The analysis of the determinants only reveals part of the explanation. It is also necessary to look at the channels that affect the labor share.


## Direct and indirect cohort effects

To neutralize the indirect cohort effect, I fix the youth political weight $\eta_t$ to its 1970's value but I keep the demographic variables' time series $n_t$, $p_t$ and $p_{t+1}$ as in the benchmark simulation. Thus, $\eta_t = \eta_{1970}$. To neutralize the direct cohort effect, I assume that all the demographic variables remain at their 1970's level. Thus, $p_t = p_{1970}$, $p_{t+1} = p_{2010}$, $n_t = n_{1970}$ and population sizes but also initial capital stocks are recalculated. But the youth political weight time series $\eta_t$ is the one of the benchmark simulation. Finally, a last counterfactual is made where I neutralize both effects.^[This last specification is the same as in the survival rate and population growth effects decomposition. So the purple curve in figure \@ref(fig:counter-pgsr).]

Figure \@ref(fig:counter-deie) displays the model predictions of the labor share with counterfactual specifications.

```{r counter-deie, fig.cap='Model predictions of the labor share with counterfactual specifications', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
# Counterfactual graphic parameters
deie_labels = c("Data", "Benchmark", expression(p[1970]*", "*n[1970]), expression(eta[1970]),
                expression(p[1970]*", "*n[1970]*", "*eta[1970]))

## Counterfactual PGSR
counter_deie = decomp %>% 
  subset(PG %in% c("TPG", NA) & SR %in% c("TSR", NA)) %>%
  mutate(DEIE = interaction(DE, IE) %>% as.character %>%
           ifelse(is.na(.), "data", .)) %>% 
  mutate(DEIE = factor(DEIE,
                       levels = c("data", "TDE.TIE", "FDE.TIE", "TDE.FIE", "FDE.FIE"))) %>% 
  
  ggplot(aes(x = Year, y = theta, color = DEIE, linetype = DEIE)) +
  facet_wrap(Country ~ .) +
  geom_line() +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom",) +
  labs(x = element_blank(), y = element_blank(), title = "Labor share",
       color = element_blank(), linetype = element_blank())

if(knitr::is_html_output()){
  counter_deie +
    scale_linetype_manual(labels = deie_labels, values = c("solid", rep("dashed", 4))) +
    scale_color_manual(labels = deie_labels, 
                       values = c("black", brewer.pal(8, "Set1")[c(1,5,8,4)]))
}
 
if(knitr::is_latex_output()){
  counter_deie +
    scale_linetype_manual(labels = deie_labels, 
                          values = c("solid", "dashed", "twodash", "dotted", "solid")) +
    scale_color_manual(labels = deie_labels, 
                       values = c("grey", rep("black", 4)))
}

```

The methodology to interpret this figure is similar to the one of the figure \@ref(fig:counter-pgsr). The dash-dotted curve corresponds to the direct cohort effect. For both countries, this curve is below the benchmark curve until 2010 and above thereafter. It means that the demographic dynamics' net impact through the direct channel is positive on the labor share until 2010 and negative thereafter. Looking at the dashed curve, it is slightly above before 2000 and largely below thereafter. The net impact of the indirect cohort effect is negative up to 2000 and positive subsequently. However, this representation is also tediously legible. Therefore, I isolate the extent of each channel with the same methodology as before. Figure \@ref(fig:decomp-deie) displays the labor share's gap between the benchmark and the counterfactuals in percentage points.

```{r decomp-deie, fig.cap='Aging-effect decomposition by determinant', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
# Labels
deie_labels2 = c("Direct cohort effect", "Indirect cohort effect",
                 "Interaction effect")

## DEIE Decomposition
decomp_deie = decomp2 %>% 
  subset(variable %in% c("FDE.TIE", "TDE.FIE", "FDE.FIE")) %>% 
  mutate(variable = factor(variable, levels = c("FDE.TIE", "TDE.FIE", "FDE.FIE"))) %>% 
  
  ggplot(aes(x = Year)) +
  geom_col(aes(y = value, fill = variable), alpha = .7) +
  geom_hline(yintercept = 0, linetype = "dotted") +
  facet_wrap(Country ~ .) +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  theme(legend.direction = "horizontal", legend.box = "horizontal", legend.position = "bottom") +
  labs(x = element_blank(), y = element_blank(), fill = element_blank(),
       title = "Difference with counterfactual (in pp.)")

if(knitr::is_html_output()){
  decomp_deie +
    geom_line(aes(y = position_DEIE), color = brewer.pal(8, "Set1")[1]) +
    scale_fill_manual(labels = deie_labels2, values = brewer.pal(8, "Set1")[c(5,8,4)])
}
 
if(knitr::is_latex_output()){
  decomp_deie +
  geom_line(aes(y = position_DEIE), color = "black") +
    scale_fill_grey(labels = deie_labels2, start = .1, end = .8)
}

```
The direct cohort effect is positive when the baby-boomers are young and after becomes negative. While the indirect cohort effect has the opposite pattern. The direct cohort effect dominates the indirect one until 2010 before to become less influential. Until 2010, if the demographic variables had been held constant, then the relatively high political power of the youth due to the baby-boomers' presence would have generated an even larger decline of the labor share. However, the aging population was mainly driven by the increasing survival rate which has thwarted part of the fall. Notice that, here again, the difference with counterfactual is less than 1% in the case of the United-States. It suggests that the aging phenomenon over this period is a larger determinant of the labor share in France compared to the United-States.
<!-- May be for the Summary -->
After 2010, so once the baby-boomers' cohort retires, the model predicts that the indirect cohort effect (i.e. the decline of the youth political power) should exceed the direct one. This is directly related to the mechanism analysis of section \@ref(pred1080). The baby-boomers and more generally the old households becomes the winners of the age-related conflict within the public policy over this period. Thereby, they reduce the workers' outside option which leads to a wage cut or more precisely to a wage stagnation. The labor cost remains constant while the capital available in the economy accumulates. It generates an incentive for the representative firm to hire more workers. As a result, the labor share increases.
<!-- May be for the Summary -->

## Summary {#summary}

```{r exp_power}
# Compute the share of each effect/channel for two sub_periods 1980-2010 & 2020-2050
decomp_mean.period = decomp2 %>% select(-contains("position")) %>% setDT %>% 
  dcast(Country + Year + break_year ~ variable) %>% 
  mutate(Country_break = interaction(break_year, Country, sep = " - "),
         Period = ifelse(Year %in% c(1970:2010), "P1",
                         ifelse(Year %in% c(2020:2050), "P2", "P3"))) %>% 
  subset(Period != "P3") %>% 
  group_by(Country_break, Period) %>% 
  select(Country_break, Period, TPG.FSR.share, FPG.TSR.share, FPG.FSR.share,
         FDE.TIE.share, TDE.FIE.share, FDE.FIE.share) %>% 
  summarise_at(vars(TPG.FSR.share:FDE.FIE.share), mean, na.rm = TRUE)
```

Figure \@ref(fig:decomp-country-period) summarizes the aging-effect decomposition by period and country.

```{r decomp-country-period, fig.cap='Aging-effect decomposition by period and country', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
# Summary
decomp_country_period = decomp_mean.period %>% setDT %>% 
  melt(id.vars = c("Country_break", "Period")) %>% 
  mutate(value = value*100) %>% 
  subset(Country_break %in% c("1970 - France", "1970 - United States")) %>% 
  mutate(Country = ifelse(Country_break == "1970 - France", "France", "United States"),
         effect = factor(ifelse(variable %>% grepl(pattern = "PG", .), "first", "second")),
         Period = ifelse(Period == "P1", "1980 - 2010", "2020 - 2050")) %>% 
  mutate(variable = factor(variable, 
    levels = c("FPG.TSR.share", "TPG.FSR.share", "FDE.TIE.share", 
               "TDE.FIE.share", "FPG.FSR.share", "FDE.FIE.share"),
    labels = c("Population growth", "Survival rate", "Direct cohort", 
               "Indirect cohort", "Interaction", "Interaction"))) %>% 
  
  ggplot(aes(x = effect, y = value, fill = variable)) +
  facet_grid(Country ~ Period) +
  scale_x_discrete(breaks = c("first", "second"), labels = c("Determinants", "Channels")) +
  theme_bw(base_size = 14) +
  theme(legend.direction = "horizontal", legend.position = "bottom") +
  labs(x = element_blank(), y = element_blank(), fill = element_blank())

## Color version
if(knitr::is_html_output()){
  decomp_country_period +
    geom_bar(stat = "identity", position = position_dodge(), color = "black", alpha = .7) +
    scale_fill_manual(values = brewer.pal(8, "Set1")[c(2,3,5,8,4)])
}

## Paper version
if(knitr::is_latex_output()){
decomp_country_period +
  geom_bar(stat = "identity", position = position_dodge(), color = "black") +
  scale_fill_grey(start = 1, end = 0)
}

```

The main determinant of the aging phenomenon is the survival rate. On average, it explains 54.5% for France and 78.1% for the United-States of the impact on the labor share over the period 1980-2010. This decomposition persists thereafter. However, the channel decomposition does not. Between 1980 and 2010, demographic dynamics affect the labor share mainly through the direct channel in France. While the indirect one is dominant in the United-States. On average, the share explained by the direct cohort effect is about 53.1% for France and 38.2% for the United-States. However, over the next period, the direct cohort effect is not the dominant channel anymore in France. It falls to 20.3%, suggesting that the indirect cohort effect becomes the main carrier of the demographic dynamics on the labor share. In contrast, it remains relatively stable in the United-States, at around 35.7%.
































