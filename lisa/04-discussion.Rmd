```{r, include = FALSE}
# Load init script
source("_script/init.R")
# knitr options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, fig.pos = "!tb")
options(kableExtra.html.bsTable = T)
# Function to round in solver
ceiling_digit = function(x, level=1) round(x+ 5*10^(-level-1), level)
flooring_digit = function(x, level=1) round(x - 5*10^(-level-1), level)
```

```{r}
# Country set
country_set = c("France", "United States")
# Simulation periods
sim = seq(1970, 2080, 10)
# Estimation sample
est_sample = c(1970:2010)
# Graphic parameters
breaks_10_years = seq(1970, 2080, 10)
labs_20_years = as.vector(rbind(seq(1970, 2080, 20), rep("", length(breaks_10_years)/2)))
scale_graph = 1920/1080
```

```{r}
# Penn World Table
pwt = file.path(loc_data, "pwt.csv") %>% read.csv %>%
  select("Country", "Year", "emp", "avh", "rgdpna", "rnna", "lab_sh1", "lab_sh2") %>% 
  subset(Country %in% country_set & Year >= 1970)
# OECD data
oecd = file.path(loc_data, "oecd.csv") %>% read.csv %>% 
  select("Country", "Year", tax_rate = "tax_rev_PC_GDP",
         union_density = "union_density.lin_inter",
         union_coverage = "union_coverage.lin_inter") %>% 
  subset(Country %in% country_set & Year >= 1970)
# Demographic data
demo = file.path(loc_data, "demo.csv") %>% read.csv %>% 
  select("Country", "Year", "young", "young_1564", "old", "dep", "n", "p") %>% 
  subset(Country %in% country_set)
## Merge
df0 = merge(pwt, oecd, all = TRUE) %>% merge(demo, all = TRUE) %>% 
  subset(Year >= 1970)
```

```{r}
# Variable modifications
df1 = df0 %>%
  group_by(Country) %>% 
  mutate(L = emp * 1000,
         Y = rgdpna / avh * 1000, # AVH control
         K = rnna / avh * 1000, # AVH control
         theta = lab_sh1, # Labor share
         tau = tax_rate / 100, # Tax rate
         u = 1 - L/young_1564, # Unemployment rate
         p1 = lead(p, 40)) %>% 
  select(Country, Year, Ny = young, No = old, n, p, p1, dep, K, L, Y, theta, tau, u) %>% 
  # Normalized labor, capital and output
  mutate_at(vars("L", "K", "Y"), ~ {./first(.)}) %>% 
  # Normalized capital-labor ratio, young and old population
  mutate(k = K/L, Ny = L/(1-u), No = Ny*dep) %>% 
  ungroup() %>% 
  # Remove unused countries from Country levels
  mutate(Country = Country %>% as.character %>% factor)
```

```{r}
# Initial Sequence
init_seq = seq(1970, 2000, 10)

# Baseline data
data_base = df1 %>% 
  group_by(Country) %>% subset(Year %in% sim) %>% 
  select(Country, Year, Ny, No, n, p, p1, K) %>% 
  mutate(Sequence = ((sim - 1970)/10) %% 4 + 1, Period = (sim - init_seq) / 40 + 1) %>% 
  mutate_at(vars("Ny", "No", "K"), ~ ifelse(Year == 2010, NA, .)) %>% 
  # Complete NA values for p1 in 2070 and 2080
  mutate(
    p1 = ifelse(Year >= 2070, 
                p1[Year == 2060] + (Year - 2060)/10 * mean(p1/lag(p1)-1, na.rm = T), 
                p1), 
    ## Create empty variables
    eta = NA, AK = NA, AL = NA, k1 = NA, k2 = NA, k = NA, X = NA, L = NA, w = NA,
    r = NA, Y = NA, u = NA, theta = NA, tau = NA, b = NA, h = NA, S = NA) 

# Re-order variables
data_base = data_base %>% 
  select(Country, Year, Sequence, Period, Ny, No, n, p, p1, eta, AK, AL,
         k1, k2, k, X, L, w, r, Y, u, theta, tau, b, h, S, K)
```

```{r}
data = data_base %>% 
  # No biased technical change
  mutate(AK = 1, AL = 1) %>% 
  # Population dynamics
  demo_changer(init_spe = TRUE)
```

```{r}
# alpha and gamma
param_base = data.frame(
  "Country" = rep(c("France", "United States"), each = length(sim)),
  "Year" = sim, "alpha" = (0.99)^40, "gamma" = 0.5)

# Dataframe for estimation of sigma
df.sigma = df1 %>% 
  group_by(Country) %>% 
  mutate(k_log = log(k), THETA_log = log(theta/(1-theta)), t_diff = Year - first(Year)) %>% 
  select(Country, Year, k_log, THETA_log, t_diff) %>% 
  subset(Year %in% c(1970:2010)) %>% 
  ungroup()
### Regressions to estimate sigma
list.sigma = list(
  ## France
  France = list(
    # One for all
    all = lm(THETA_log ~ k_log + t_diff, data = df.sigma, 
             subset = Country == "France") %>% 
      coef %>% {1/(1+.[2])} %>% unname(),
    # Before 1985
    before85 = 1,
    # After 1985
    after85 = lm(THETA_log ~ k_log, data = df.sigma,
               subset = Country == "France" & Year > 1985) %>% 
      coef %>% {1/(1+.[2])} %>% unname()
  ),
  # United-States
  `United States` = list(
    all = lm(THETA_log ~ k_log, data = df.sigma, 
             subset = Country == "United States") %>% 
    coef %>% {1/(1+.[2])} %>% unname
    )
)
# Add production function parameters (sigma for all)
param_base = param_base %>%
  merge(df1 %>% subset(Year == 1970) %>% mutate(phi = 1-theta) %>% 
          select(Country, phi)) %>% 
  merge(data.frame(Country = c("France", "United States"),
                   sigma = c(list.sigma$France$all, 
                             list.sigma$`United States`$all))) %>% 
  mutate(a = NA)

# Compute omega and beta
param_base = param_base %>%
  merge(., df1) %>% 
  mutate(X = (sigma + (1-phi)/phi*(1-gamma*(1-sigma))/gamma*k^((1-sigma)/sigma))^(-1),
         eta = (1-phi)/phi*k^((1-sigma)/sigma) * ((Ny/K*k-1)*exp(-X) + 1),
         omega = n/p*(1+alpha*p1)/eta,
         beta = 1/(1 - tau)/(1-theta) - 1 - eta) %>% 
  group_by(Country) %>% 
  mutate(omega = first(omega), beta = first(beta)) %>% 
  select(Country, Year, alpha, gamma, phi, sigma, a, omega, beta) %>% 
  ungroup()

# Change sigma for France
param_base = param_base %>% 
  mutate(sigma = ifelse(Country == "France",
                        ifelse(Year <= 1980, list.sigma$France$before85,
                               list.sigma$France$after85), sigma))

## Grid search for A (Scale parameter)
# Set data
data = data_base %>% 
  # No biased technical change
  mutate(AK = 1, AL = 1) %>% 
  # Add parameters
  merge(param_base) %>% 
  # Demography
  demo_changer(AFinder = TRUE)
# A Finder script
source(file.path(loc_script, "sim_AFinder.R"))
# Assign A scale parameter to param_base
param_base$A = data$A
# Assign values
param = param_base
```

```{r}
breakers = demo %>% 
  ## Compute demographic data for 1960
  subset(Year == 1960) %>% 
  mutate(Sequence = NA, Period = NA, Ny = NA, No = NA, p1 = NA) %>% 
  select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
  rbind(., data_base %>% 
          select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
          subset(Year == 2000) %>% 
          ungroup()) %>% 
  group_by(Country) %>% 
  mutate(p1 = ifelse(Year == 1960, dplyr::lead(p), p1),
         Ny = ifelse(Year == 1960, dplyr::lead(Ny)/dplyr::lead(n), Ny),
         No = ifelse(Year == 1960, p/n*Ny, No),
         Sequence = ifelse(Year == 1960, 4, Sequence),
         Period = ifelse(Year == 1960, 0, Period)) %>% 
  subset(Year == 1960) %>% 
  ungroup() %>% 
  ## Demographic data for 1960 : done
  rbind(., data_base %>% 
          select(Country, Year, Sequence, Period, Ny, No, n, p, p1) %>% 
          ungroup()) %>% 
  arrange(Country) %>% 
  merge(., param_base %>% select(Country, alpha, omega) %>% unique()) %>% 
  group_by(Country, Sequence) %>% 
  mutate(eta = n/p*(1+alpha*p1)/omega,
         Ny = ifelse(Period == 2, lag(Ny,1)*n, Ny),
         No = ifelse(Period == 2, lag(Ny,1)*p, No),
         Ny = ifelse(Period == 3, lag(Ny,1)*n, Ny),
         No = ifelse(Period == 3, lag(Ny,1)*p, No),) %>% 
  select(-alpha, -omega) %>% 
  ungroup()
```

```{r}
list.sim = list()
```

```{r}
# Specification
spe = "baseline"

# Initialize result dataset
final = data.frame(matrix(ncol = ncol(data)+ ncol(param) -2 + 1, nrow = 0)) %>%
  setNames(c("Specification", names(data), names(param)[-c(1,2)]))

# Prepare data for simulation
data = data_base %>% 
  # Merge with parameters
  merge(param) %>% 
  # No BTC
  mutate(AK = 1, AL = 1) %>% 
  # Demography
  demo_changer() %>% 
  # Define specification model
  mutate(Specification = spe) %>%
  # Reorder variables
  select(Specification, everything())

# Prepare result data frame to loop on
result = final

# Simulate the baseline model for each country
for(country in country_set){
    result = data %>%
      subset(Country == country) %>% 
      model(time = 3) %>% 
      rbind(result, .)
}

# Regroup result
list.sim$baseline = result
```

# Discussion {#discussion}

## Age-related conflict: who are the winners ? {#winners}

```{r}
# Compute redistribution
redis = list.sim$baseline %>%
  group_by(Country) %>% 
  # Compute GDP split
  mutate(
    # Step 1
    wL = w*L, rK = r*K,
    # Step 2
    wL_net = (1-tau)*wL, rK_net = (1-tau)*rK, gov_rev = tau*Y,
    # Step 3
    unemp_ben = b*u*Ny, health_spen = h*No,
    # Step 4
    C1 = 1/(1+alpha*p1)*(wL_net+unemp_ben),
    Saving = alpha*p1/(1+alpha*p1)*(wL_net+unemp_ben),
    C2 = rK_net,
    # Incomes
    inc_y = wL_net + unemp_ben, inc_o = rK_net,
    # Labor share
    theta = wL/Y
    ) %>% 
  select(Country, Year, wL, rK, wL_net, rK_net, gov_rev, unemp_ben, health_spen,
         C1, Saving, C2, inc_y, inc_o, Y, theta, eta) %>% 
  ungroup()
```

So far, the labor share has been declining due to the baby-boomers generation in both countries. First, when they were young because they shaped the public policy and so the labor market institutions in their favor. The firms answered to that by substituting labor to capital. Second, when they were old because they have considerably increased the available capital in the economy through savings allowing the firms to substitute even more. However, the labor income share is a gross indicator of inequalities. A more appropriate indicator may be the income ratio between young and old after redistribution. 

From equation \@ref(eq:after-tax-income-ratio), I have that the after-tax young-to-old income ratio is equal to the young political weight (i.e. $Y_t^y/Y_t^o = \eta_t$). While the before-tax young-to-old income ratio corresponds to the labor-to-capital ratio (i.e. $\Theta_t = \frac{w_tL_t}{r_tK_t}$). Figure \@ref(fig:raw-vs-net-inc-ratio) displays these income ratios in deviation from the 1970 steady-state.

```{r raw-vs-net-inc-ratio, fig.cap='Deviation from 1970 value of the labor-to-capital income ratio and the young-to-old income ratio',fig.width=7, out.width='100%', fig.asp=.5, fig.align='center', dpi=200}
## Core
dev_incratio_raw_vs_net = redis %>% 
  select(Country, Year, inc_y, inc_o, wL, rK, health_spen, eta) %>% 
  group_by(Country) %>% 
  mutate(inc_ratio = inc_y/inc_o,
         #inc_ratio_with_h = inc_y/(inc_o + health_spen),
         lab_to_cap_ratio = wL/rK) %>% 
  mutate_at(vars(contains("ratio")), ~ {./.[Year == 1970] -1}) %>% 
  select(Country, Year, lab_to_cap_ratio, inc_ratio) %>% 
  setDT %>% melt(id.vars = c("Country", "Year")) %>% 
  mutate(variable = factor(variable, labels = c("Labor-to-capital",
                                                "Young-to-old"))) %>% 
  
  ggplot(aes(x = Year, y = value, linetype = variable, color = Country)) +
  geom_line() +
  geom_hline(yintercept = 0, linetype = "dotted") +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  labs(x = element_blank(), y = element_blank(), 
       linetype = "Income ratio", color = "Country") +
  theme(legend.position = "right")

if(knitr::is_html_output()){
  dev_incratio_raw_vs_net +
    scale_color_brewer(palette = "Set1")
}

if(knitr::is_latex_output()){
  dev_incratio_raw_vs_net +
    scale_color_grey(start = 0, end = .5)
}

```

<!-- The solid curve corresponds to the before-tax young-to-old income $\Theta_t$ ratio also named the labor-to-capital income ratio $\frac{w_tL_t}{r_tK_t}$ and the dashed curve is the after-tax young-to-old income ratio $Y_t^y/Y_t^o$ which is equal to the youth political power $\eta_t$. Deviation is expressed in percentage. -->
<!-- % and the dotted line is the after-tax young-to-old income ratio with government health spending included in old households income $Y_t^y/(Y_t^o+h_tN_t^o$). -->

While the labor share and so the labor-to-capital ratio (i.e. before-tax young-to-old income ratio) sharply decline between 1970 and 2000, the after-tax young-to-old income ratio lies over its 1970's level during the same period. Even if I include the government health spending as part of the old households income, the young-to-old income ratio remains over its initial level until 2000.^[In terms of deviation, the curve is combined with the dashed one.] This model prediction holds for both countries. The baby-boomers gross income share (i.e. labor income share) has declined due to the mechanisms previously mentioned when they were young. However, they also have spurred political parties to implement redistributive public policies.^[This is the result of the probabilistic voting specification. The opportunist behavior of political parties lead them to favor this generation in order to maximize their probability to win the election.] This redistribution is characterized, in terms of the model, through a raise of the tax rate and an increase of the unemployment spending share within the government revenue.^[Notice that the increase of the unemployment spending share is driven and accentuated by the raising unemployment due to factor substitution.] Thus, they have been able to seize part of their elders income through redistribution. Even though baby-boomers appeared as income losers over this period because the labor share was falling, they are actually the winners once net income is considered.

Another way to determine the winners of the age-related conflict within the public policy is to look how the GDP is allocated in the economy. Figure \@ref(fig:redis-step3-stacked) displays the income allocation after redistribution.

```{r redis-step3-stacked, fig.cap='After-tax income share allocation', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
## 3rd step decomposition of GDP
redis_step3_stacked = redis %>% 
  mutate(wL_net = wL_net/Y,
         unemp_ben = unemp_ben/Y,
         health_spen = health_spen/Y,
         rK_net = rK_net/Y) %>% 
  select(Country, Year, rK_net, health_spen, unemp_ben, wL_net, theta) %>% 
  setDT %>% melt(id.vars = c("Country", "Year", "theta")) %>%
  mutate(variable = factor(variable, levels = c("rK_net", "health_spen", "unemp_ben", "wL_net"), 
                           labels = c("Net capital income", "Health spending", 
                                      "Unemployment spending", "Net labor income"))) %>% 
  
  ggplot(aes(x = Year)) +
  geom_col(aes(y = value, fill = variable)) +
  geom_line(aes(y = theta), linetype = "dashed", color = "black") +
  facet_wrap(Country ~ .) +
  scale_x_continuous(breaks = breaks_10_years, labels = labs_20_years) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom", panel.spacing.x = unit(1.5, "lines")) +
  labs(x = element_blank(), y = element_blank(), title = "Share of GDP",
       fill = element_blank()) + 
  guides(fill = guide_legend(nrow = 2, byrow = TRUE))

## Color version
if(knitr::is_html_output()){
  redis_step3_stacked +
    scale_fill_manual(values = brewer.pal(8, "Set3")[c(4,6,3,5)])
}

## Paper version
if(knitr::is_latex_output()){
redis_step3_stacked +
  scale_fill_grey(start = .8, end = 0)
}
```


The dashed curve corresponds to the labor share, so the before-tax young income share. As long as this curve lies in the area of the government unemployment spending share, it means that old agents fund unemployment spending through their taxes. On the contrary, when the dashed curve lies in the area of the government health spending share, the young agents fund government health spending for their elders. The US share of GDP which is allocated to health spending is quite small compared to the French one. This is directly related to the preference parameter for government health spending $\beta$.^[$\beta_{\text{FR}} = 0.739$ and $\beta_{\text{US}} = 0.138$.] The US young generations are the winners of the age-related conflict from 1970 to 2020 which corresponds to the active period of the baby-boomers. Once the US population ages and therefore the baby-boomers, old households dominates the public policy conflict. However, the size of the government revenue declines due to the fact that the United-States converges to full employment in the long run. For France, the baby-boomers also dominate the public policy conflict between 1990 and 2010 when they are active. Once they retire, so over the period 2010-2040, they are still the winners of this conflict and their children fund government health spending. Notice that the size of the welfare state corresponds to the sum of the unemployment benefits share in GDP and the health spending share in GDP.

## Retirement age {#retirement}

```{r retage_init}

# Define break_year
break_year = 2020
# Define first years after the reform
first_years = seq(break_year+10, (break_year+40), by = 10)

# Init ret_age
list.sim$retage = data.frame(matrix(ncol = ncol(result)+3, nrow = 0)) %>%
  setNames(c(names(result), c("p_fix", "p1_to_p_dist", "shock")))

for(spe in c(1:3)){

if(spe == 1){shock = -1/10}
if(spe == 2){frac = 0}
if(spe == 3){frac = .5}

# Re initialize result data frame
result = result[0,] %>% 
  data.frame()
  
# Prepare data
data = data_base %>% 
  # No biased technical change
  mutate(AK = 1, AL = 1) %>% 
  # Add parameters
  merge(param) %>% 
  # Demography
  demo_changer(break_year = break_year, p1_equals_p_fix = FALSE) %>% 
  # Define specification model
  mutate(Specification = spe) %>%
  # Reorder variables
  select(Specification, everything())

## Modification of demographic data
if(spe == 1){
data = data %>% 
  group_by(Country, Sequence) %>% 
  mutate(
    # New p, p1 and n
    p.new = ifelse(Year > break_year, p*(1+shock), p),
    p1.new = ifelse(Year > break_year, p1*(1+shock), p1),
    n.new = ifelse(Year %in% first_years, n*(1-shock), n),
    
    p_fix = NA,
    p1_to_p_dist = NA,
    shock = shock,
    )
}
if(spe %in% c(2,3)){
data = data %>% 
  group_by(Country, Sequence) %>% 
  # Merge with break year
  merge(., data_base %>% 
          subset(Year == break_year) %>%
          select(Country, p_fix = p), by = "Country") %>% 
  
  mutate(
    p1_to_p_dist = p1 - p,
    # New p and p1
    p.new = ifelse(Year > break_year, frac*(p-p_fix) + p_fix, p),
    p1.new = ifelse(Year > break_year & Period < 3, dplyr::lead(p.new,1),
                    ifelse(Period == 3, p.new + p1_to_p_dist*frac, p1)),
    # Scale for the affected periods
    shock = (p.new - p)/p
    )
}

data = data %>% 
  mutate(
    # New n
    n.new = ifelse(Year %in% first_years, n*(1-shock), n),
    # Compute Ny and No for the affected periods
    Ny.new = ifelse(Year %in% first_years, Ny*(1-shock), NA),
    No.new = ifelse(Year %in% first_years, No*(1+shock), NA),
    # Compute Ny and No for last sequence/periods
    Ny.new = ifelse(Year > max(first_years), lag(Ny.new,1)*n, Ny.new),
    No.new = ifelse(Year > max(first_years), lag(Ny.new,1)*p.new, No.new),
    # Recompute eta
    eta.new = n.new/p.new*(1+alpha*p1.new)/omega,
    # Replace values
    Ny = ifelse(is.na(Ny.new), Ny, Ny.new),
    No = ifelse(is.na(No.new), No, No.new),
    n = n.new,
    p = p.new,
    p1 = p1.new,
    eta = eta.new
    ) %>% 
  select(Specification, Country, Year, Sequence, Period, Ny, No, n, p, p1, 
         eta, everything(), -contains("new"), ) %>%
  ungroup()


# Simulate the model for each country
for(country in country_set){
  result = data %>%
  subset(Country == country) %>% 
  model(time = 3) %>% 
  rbind(result, .)
}

# Remove duplicates
list.sim$retage = rbind(list.sim$retage, result)
}

```

So far, I have not discussed the retirement age and its implications on the labor share.
<!-- % Literature on the impact of the retirement age on growth / Futagami and Nakajima (2001) / Gonzalez-Eiras and Nieplet (2012) / ? -->
As mentioned in the introduction, the relationship between aging and economic growth has received much more attention than the one with the labor share. @Gonzalez-Eiras2012 predict that the retirement age in OECD countries should increase in response to population aging. In their model of politico-economic equilibrium, individuals vote with perfect foresight and decide to raise retirement age as long as population ages. Agents work longer and so accumulate more wealth, it reduces social-security transfers and thereby releases more government spending to public investment which is an engine for growth.^[However, this result contrasts with @Jager2016 who find out that the share of elderly people and public investment are negatively co-integrated. They use panel data of 19 OECD countries from 1971 to 2007. This gap may be due to two reasons: *i)* some public policy instruments which are not considered in the model of @Gonzalez-Eiras2012 might invert the relationship between aging and public investment; *ii)* the perfect foresight assumption might be too strong. Both potential explanations may reconcile these diverging results.] On the contrary, @Futagami2001 claim that population aging does not necessarily depress economic growth and may even foster it through savings. Thus, postponing the retirement age would result in a decline of savings and so the economic growth. @Dedry2017 also discuss the role of legal retirement age according to the type of pension system in a context of population aging due to either declining fertility or increasing longevity.

In order to take into account the role of retirement age, I perform counterfactual predictions with different scenarii based on an exogenous change. The retirement age is captured within the variable $p_t$ which depends negatively on it but positively on the life expectancy. I do not endogenize this variable due to the limited form of rationality and to the several assumptions that would be required.^[To have an endogenous retirement age, agents should vote on it and thereby vote on the survival rate. The first question would be to determine whether agents vote on $p_t$, $p_{t+1}$ or both. Then, the perfect annuity market would have a lot of implications on the results. Since savings of young agents who die before reaching old age are distributed among their surviving peers, it means that an agent has an incentive to vote for a decline of the survival rate because fewer peers would reach old age. Thus, it would increase its income and so its utility. Therefore, it would be necessary to determine whether or not agents internalize the perfect annuity market in their voting decisions.] In the public debate, it is often argued that the legal retirement age should change in the future, usually upward, as claimed by @Gonzalez-Eiras2012.
<!-- % (more/other references). -->
. Between 2020 and 2030, I suppose a positive exogenous shock on the age of retirement. Meaning that less individuals would reach the old age which is translated into a decline of the survival rate, i.e. $p_t$. As in section \@ref(counterfactual), other demographic variables have to be changed for the period following the shock of each simulation's sequence (i.e. 2030, 2040, 2050 and 2060). However, the implications for demographic dynamics are not identical to this previous exercise. Because the greater the retirement age, the longer an individual remains young in terms of the model. Thus, these individuals do not vanish but just remain longer in the labor force.^[In the same way, the capital stock of these periods is not changed as in section \@ref(counterfactual) because it has already been accumulated through savings from previous periods. It has no reason to vanish or to be scraped.]
<!-- %The logic is the same as the law of conservation of mass from A. Lavoisier: ``*[...] nothing is lost, nothing is created, everything is transformed*''. -->
Therefore, conjointly with the decline of the survival rate, there is a share of the young population that does remain young.
From the identity $\frac{N_t^o}{N_t^y} \equiv \frac{p_t}{n_t}$, I obtain:
\begin{equation}
	\frac{\dot{N}_t^o}{N_t^o} - \frac{\dot{N}_t^y}{N_t^y} = \frac{\dot{p}_t}{p_t} - \frac{\dot{n}_t}{n_t} (\#eq:demo-growth-identity)
\end{equation}
where the upper dotted variables correspond to the variables' variation, e.g. $\dot{N}_t^o = {N_t^o}^\prime - N_t^o$ where ${N_t^o}^\prime$ is the new value for $N_t^o$. This equation has to be satisfied. The exogenous shock on $p_t$ affects all other demographic variables. Firstly, the size of the old population varies as much as the survival rate does, i.e. $\frac{\dot{N}_t^o}{N_t^o} = \frac{\dot{p}_t}{p_t}$. Secondly, the variations of the young population's size are inversely proportional to the ones of the old population size, i.e. $\frac{\dot{N}_t^y}{N_t^y} = -\frac{\dot{N}_t^o}{N_t^o}$. Thirdly, by taking into account the two previous points and the fact that equation \@ref(eq:demo-growth-identity) has to be satisfied, it implies that $\frac{\dot{n}_t}{n_t} = -\frac{\dot{p}_t}{p_t}$. Therefore, the exogenous shock on $p_t$ affects the other variables with the same magnitude.
<!-- % ^[To be more precise, the magnitude of the shocks on $N^y_t$ and $n_t$ should decrease over time.] -->
Hence,
\begin{align*}
	\dot{N}^o_t = \frac{\dot{p}_t}{p_t} N^o_t \implies& {N^o_t}^\prime = \left(1+\frac{\dot{p}_t}{p_t}\right) N^o_t \\
	\dot{N}^y_t = -\frac{\dot{p}_t}{p_t} N^y_t \implies& {N^y_t}^\prime = \left(1-\frac{\dot{p}_t}{p_t}\right) N^y_t \\
	\dot{n}_t = -\frac{\dot{p}_t}{p_t} n_t \implies& {n_t}^\prime = \left(1-\frac{\dot{p}_t}{p_t}\right) n_t
\end{align*}
where $\frac{\dot{p}_t}{p_t} = \frac{p^\prime_t - p_t}{p_t} \implies p^\prime_t = p_t + \dot{p}_t$. Thus, the new demographics variables $N^{o\prime}_t, N^{y\prime}_t, p^\prime_t, n^\prime_t$ are computed for the years 2030, 2040, 2050 and 2060. For the years 2070 and 2080: $n^\prime_t$ follows the benchmark time series and population sizes are computed with $N^{o\prime}_t = p^\prime_t {N^{y\prime}_{t-1}}$ and $N^{y\prime}_t = n^\prime_t N^{y\prime}_{t-1}$. Notice that new values of the expected survival rate $p^\prime_{t+1}$ changes according to $p^\prime_t$. Moreover, $\eta^\prime_t = \frac{n^\prime_t}{p^\prime_t}\frac{1+\alpha p^\prime_{t+1}}{\omega}$ is also recomputed.

Two types of scenario are possible for a change in the age of retirement between 2020 and 2030. Firstly, I consider that the retirement age increases in such a way that the survival rate is negatively affected by 10% in 2030.^[The underlying (strong) assumption of this whole exercise is that the change in retirement age has no consequences on life expectancy. Some authors argue that increasing the retirement age has a negative impact on health and so the life expectancy (see, for example, @Insler2014 for the United-States; @Coe2011 for Europe). Thereby, the negative effect on the survival rate may be all the more tenacious due to the declining life expectancy. Despite the presence of a potential co-integration of the retirement age and the life expectancy, I believe that the qualitative impact is not affected in the sense that the simulation is a lower bound.] Thereafter, the survival rate grows at the same growth rate as in the benchmark simulation.^[I assume that the shock does not change the future growth path of the survival rate.] This first scenario can be summarized as a one-shot shift by 10% of the survival rate. Secondly, another scenario is to consider that retirement age increases in such a way that the survival rate grows at a fraction $\zeta \in \left[0,1\right]$ of the benchmark simulation's growth rate. The new values of the survival rate $p^\prime_t$ after 2030 are described as follow:
\begin{equation*}
	p^\prime_t = \zeta(p_t - \bar{p}) + \bar{p}
\end{equation*}
where $\bar{p}$ is the value of the survival rate in 2030. This can be interpreted as a gradual increase of the retirement age that is proportional to improvement in life expectancy.^[When $\zeta = 1$, the survival rate dynamic corresponds to the one of the benchmark simulation, i.e. $p_t^\prime = p_t$. Thus, variations are no longer proportional to changes in life expectancy. While when $\zeta = 0$, the survival rate remains constant, i.e. $p_t^\prime = \bar{p}$ after 2030. In such a case, variations in retirement age are fully proportional to the ones in life expectancy.] Such dynamics imply perfect forecasts on life expectancy which are assumed in this model.

Figure \@ref(fig:retage-p) displays the survival rate dynamics with changing retirement age specifications for both countries.
```{r, retage-p, fig.cap='Survival rate dynamics with changing retirement age specifications', fig.width=7, out.width='100%', fig.asp=.5, fig.align='center', dpi=200}
## Survival rate dataframe
retage_p = list.sim$retage[,-c({ncol(list.sim$retage)-2}:ncol(list.sim$retage))] %>%
  rbind(list.sim$baseline) %>% 
  select(Specification, Country, Year, p, p1) %>% setDT %>% 
  melt(id.vars = c("Specification" ,"Country", "Year")) %>% 
  subset(Year >= 2020) %>% 
  mutate(Specification = factor(Specification,
    levels = c("baseline", 1:3),
    labels = c("Benchmark", "Shift -10%", "Constant", "Half growth")))

## Color version
if(knitr::is_html_output()){
  retage_p  %>% 
  
  ggplot(aes(x = Year, y = value, linetype = variable, color = Specification)) +
  geom_line() +
  facet_wrap(Country ~ ., scales = "fixed") +
  scale_linetype_manual(values = c("solid", "dashed"), 
                        labels = c(expression(p[t]), expression(p[t+1]))) +
  scale_color_manual(values = c("black", brewer.pal(8, "Set1")[c(1:3)])) +
  scale_x_continuous(breaks = seq(2020, 2080, 10),
                     labels = c("2020", "", "2040", "", "2060", "", "2080")) +
  theme_bw(base_size = 14) +
  theme(legend.position = "right", legend.text.align = 0, 
        panel.spacing.x = unit(1, "lines")) +
  labs(x = element_blank(), y = element_blank(), linetype = "Variable",
       color = "Scenario", title = "Survival rates") +
  guides(linetype = guide_legend(order = 1), color = guide_legend(order = 2))
}

## Paper version
if(knitr::is_latex_output()){
  retage_p %>% 
  
  ggplot(aes(x = Year, y = value, linetype = Specification, color = variable)) +
  geom_line() +
  facet_wrap(Country ~ ., scales = "fixed") +
  scale_linetype_manual(values = c("solid", "dashed", "dotdash", "dotted")) +
  scale_color_grey(start = 0, end = .5, labels = c(expression(p[t]), expression(p[t+1]))) +
  scale_x_continuous(breaks = seq(2020, 2080, 10),
                     labels = c("2020", "", "2040", "", "2060", "", "2080")) +
  theme_bw(base_size = 14) +
  theme(legend.position = "right", legend.text.align = 0, 
        panel.spacing.x = unit(1, "lines")) +
  labs(x = element_blank(), y = element_blank(), linetype = "Scenario",
       color = "Variable", title = "Survival rates") +
  guides(linetype = guide_legend(order = 2), color = guide_legend(order = 1))
}

```

The dashed curves correspond to the first scenario mentioned above where the survival rate is shocked by -10% in 2030 and keeps its growth rate thereafter. The dash-dotted and dotted curves are two special cases of the second scenario. The dashed-dotted curves refers to the case where $\zeta = 0$, so the survival rate remains constant after 2030. It means that variations in retirement age are fully proportional to those in life expectancy. While the dotted curves coincide to the case where $\zeta = .5$. Thus, the survival rate $p_t$ grows at half of the speed of the benchmark simulation.

Figure \ref{fig:retage_ls} displays model predictions of the labor share according to the scenario.
```{r retage-ls, fig.cap='Model predictions of the labor share with changing retirement age specifications', fig.width=7, out.width='100%', fig.asp=.66, fig.align='center', dpi=200}
## Survival rate dataframe
retage_ls = list.sim$retage[,-c({ncol(list.sim$retage)-2}:ncol(list.sim$retage))] %>%
  rbind(list.sim$baseline) %>% 
  select(Specification, Country, Year, theta) %>% setDT %>% 
  melt(id.vars = c("Specification" ,"Country", "Year")) %>% 
  subset(Year >= 2020) %>% 
  mutate(Specification = factor(Specification,
    levels = c("baseline", 1:3),
    labels = c("Benchmark", "Shift -10%", "Constant", "Half growth")))

## Color version
if(knitr::is_html_output()){
  retage_ls  %>% 
  
  ggplot(aes(x = Year, y = value, linetype = Specification, color = Specification)) +
  geom_line() +
  facet_wrap(Country ~ ., scales = "fixed") +
  scale_color_manual(values = c("black", brewer.pal(8, "Set1")[c(1:3)])) +
  scale_linetype_manual(values = c("solid", rep("dashed", 3))) +
  scale_x_continuous(breaks = seq(2020, 2080, 10),
                     labels = c("2020", "", "2040", "", "2060", "", "2080")) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom", legend.text.align = 0) +
  labs(x = element_blank(), y = element_blank(), linetype = "Scenario",
       color = "Scenario", title = "Labor share")
}

## Paper version
if(knitr::is_latex_output()){
  retage_ls %>% 
  
  ggplot(aes(x = Year, y = value, linetype = Specification, color = Specification)) +
  geom_line() +
  facet_wrap(Country ~ ., scales = "fixed") +
  scale_color_manual(values = rep("black", 4)) +
  scale_linetype_manual(values = c("solid", "dashed", "dotdash", "dotted")) +
  scale_x_continuous(breaks = seq(2020, 2080, 10),
                     labels = c("2020", "", "2040", "", "2060", "", "2080")) +
  theme_bw(base_size = 14) +
  theme(legend.position = "bottom", legend.text.align = 0) +
  labs(x = element_blank(), y = element_blank(), linetype = "Scenario",
       color = "Scenario", title = "Labor share")
}
```


<!-- The solid black curve corresponds to the labor share from the benchmark prediction. Dashed curves correspond to different changes in retirement age. \textit{Shift -10\%} corresponds -->
The raise of the age of retirement in France leads to a decline of the labor share with respect to the benchmark simulation in a first phase. In a second phase, the very long-run, the labor share is relatively greater than in the benchmark case. This result holds regardless of the scenario. In the United-States, the impact on the labor share depends on the scenario. As in France, the -10% shift scenario generates a sharper decline of the labor share before to exceed the benchmark simulation's one in the very long-run. However, both scenarii of diminished growth of the survival rate have roughly the same pattern of the benchmark labor share. But there are still above the labor share in the very long-run. Therefore, changing the retirement age may have different impact on the labor share according to the country.

<!-- Mechanisms -->
The underlying mechanisms are related to those detailed in section \@ref(quantitative). However, there is a particularity to this change of the retirement age. The capital stock does not immediately adjust in the model. Because it has been determined by the savings of the previous period of each sequence, where the expected survival rate $p_{t+1}$ was much greater than the after-reform one $p^\prime_{t+1}$. This specificity cancels part of the direct cohort effect. This relatively high amount of available capital stock plays in favor of the firm within the wage bargaining. Because the firm is all the more able to substitute labor with capital. On the indirect cohort effect's side, the agents remain young longer due to the increase of the retirement age. This is translated in terms of the model with a decrease of the number of old households and an increase of the number of young households. Thus, the youth has more political weight than in the benchmark case. With this political strength, they raise their outside option through pro-young public policies which allows them to bargain greater wages. As a response, the firm shift away from labor and hire relatively less workers than in the benchmark case. As mentioned above, the relatively high amount of available capital stock due to the *stickiness* enables the firm to substitute all the more.





