---
title: "X & Sigma condition"
author: "Fabien Petit"
date: "11/06/2019"
output: 
  github_document:	
    pandoc_args: --webtex
---

```{r Init, include = FALSE}	

# Load packages
packages <- c("dplyr", "ggplot2", "ggrepel", "RColorBrewer", "reshape2", "extrafont", "latex2exp")
lapply(packages, require, character.only = TRUE)
rm(packages)

# Define paths
loc_final = file.path("data", "final")

# Define country set
# country_set = c("Australia", "Canada", "France", "Italy", "Japan", "United States")
country_set = c("France", "United States")

# Graphic parameter
scale_graph = 1920/1080

```	

In the model, I obtain a condition on the capital-labor elasticity of substitution $\sigma$ and the unemployment replacement rate which ensures a positive capital-to-labor ratio and therefore a positive wage. This condition is the following :
$$
\frac{1}{\sigma} > X_t \equiv \ln\left[\frac{(1-\tau_t)w_t}{b_t}\right]
$$
where $X_t$ is the value-added to have a job in utility terms, $w_t$ is the wage rate, $tau_t$ the tax rate and $b_t$ the unemployment benefits per capita. Thus, it is possible to rewrite this condition such that :
$$
e^{-\frac{1}{\sigma}} < \frac{b_t}{(1-\tau_t)w_t}
$$
The right hand side of this inequality corresponds to the unemployment replacement rate. Hence, I check whether this constraint is feasible for OECD countries and particulary those considered in the simulation (i.e. France and United States).

Let plot the function $f(\sigma) = e^{-\frac{1}{\sigma}}$ for likely values of $\sigma$, so an interval between 0 and 3 :

```{r f Plot, echo = FALSE}

# Define function
sigma = function(urep){
  F1 = - log(urep)^(-1)
  return(F1)
}

# Interval between 0 and 3 for feasible values of urep
interval = seq(0.001, 0.8, by = 0.001)

# Compute sigma values
xsigma = data.frame("Function", interval, sigma(interval)) %>% 
  setNames(c("Country", "interval", "sigma_values"))

## Add latex
xsigma %>% 
  ggplot(aes(x = interval, y = sigma_values)) +
  geom_line(size = 1) +
  theme_classic(base_size = 14) +
  labs(x = "Unemployment Replacement Rate", y = "Max Capital-labor elasticity of substitution")

```

```{r f Plot and Country - Computation, echo = FALSE}
# Load CWED data
cwed = read.csv(file.path(loc_final, "cwed.csv"), header = TRUE)

# Average, min and first value of Unemployment Replacement Rate
cwed = cwed %>% 
  group_by(Country) %>% 
  summarise(US100_min = min(US100.lin_inter, na.rm = TRUE),
         UC1000_min = min(UC1000.lin_inter, na.rm = TRUE),
         US100_mean = mean(US100.lin_inter, na.rm = TRUE),
         UC1000_mean = mean(UC1000.lin_inter, na.rm = TRUE),
         US100_first = first(na.omit(US100.lin_inter)),
         UC1000_first = first(na.omit(UC1000.lin_inter)))

# Visualization
cwed

```


```{r x_min, echo = FALSE}
# Country set
country_set = c("France", "United States")

# Select Min for France and US
min_x = cwed %>% 
  subset(Country %in% country_set) %>% 
  select(Country, US100_min) %>% 
  setNames(c("Country", "interval")) %>%
mutate(sigma_values = -log(interval)^(-1))

min_x
```


```{r f Plot and Country, echo = FALSE}

### Plot

## Add latex
xsigma %>% 
  ggplot(aes(x = interval, y = sigma_values)) +
  geom_line() +
  # geom_label_repel(data = min_x,
  #                  aes(label = round(sigma_values,3), color = Country),
  #                  segment.color = "transparent") +
  # Horizontal line
  geom_segment(aes(x = 0, xend = 0.8,
                   y = min_x %>% 
                     subset(Country == "France") %>% pull("sigma_values"),
                   yend = min_x %>% 
                     subset(Country == "France") %>% pull("sigma_values")),
               col = brewer.pal(8, "Set1")[1], linetype = "solid") +
  # Horizontal line
  geom_segment(aes(x = 0, xend = 0.8,
                   y = min_x %>% 
                     subset(Country == "United States") %>% pull("sigma_values"),
                   yend = min_x %>% 
                     subset(Country == "United States") %>% pull("sigma_values")),
               col = brewer.pal(8, "Set1")[2], linetype = "solid") +
  # Vertical line
  geom_segment(aes(x = min_x %>% 
                     subset(Country == "France") %>% pull("interval"),
                   xend = min_x %>% 
                     subset(Country == "France") %>% pull("interval"),
                   y = 0,
                   yend = min_x %>% 
                     subset(Country == "France") %>% pull("sigma_values")),
               col = brewer.pal(8, "Set1")[1], linetype = "longdash") +
  # Vertical line
  geom_segment(aes(x = min_x %>% 
                     subset(Country == "United States") %>% pull("interval"),
                   xend = min_x %>% 
                     subset(Country == "United States") %>% pull("interval"),
                   y = 0,
                   yend = min_x %>% 
                     subset(Country == "United States") %>% pull("sigma_values")),
               col = brewer.pal(8, "Set1")[2], linetype = "longdash") + 
  annotate("text", x = 0.2, y = 0.3 + min_x %>% subset(Country == "France") %>% pull("sigma_values"),
           label = TeX(paste0('$\\bar{\\sigma}_{FR} = ',
           min_x %>% subset(Country == "France") %>% pull("sigma_values") %>% round(3), '$')),
           size = 5, col = brewer.pal(8, "Set1")[1]) +
  annotate("text", x = 0.2, y = -0.3 + min_x %>% subset(Country == "United States") %>% pull("sigma_values"),
           label = TeX(paste0('$\\bar{\\sigma}_{US} = ',
           min_x %>% subset(Country == "United States") %>% pull("sigma_values") %>% round(3), '$')),
           size = 5, col = brewer.pal(8, "Set1")[2]) +
  scale_color_manual(values = brewer.pal(8, "Set1")[c(1,2)]) +
  scale_x_continuous(expand = c(0,0)) +
  scale_y_continuous(expand = c(0,0)) +
  theme_classic(base_size = 14) +
  theme(legend.position = "none") +
  labs(x = "Unemployment Replacement Rate", y = "Capital-Labor Elasticity of Substitution") +
  ggsave(file.path(loc_result, "xsigma.png"), width = scale_graph*5, height = 5)

```








